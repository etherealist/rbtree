<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Red-Black Tree 0.8</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      word-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header id="title-block-header">
<h1 class="title">Red-Black Tree 0.8</h1>
</header>
<ul class="incremental">
<li>Bonus: <span class="title-ref">qs.h</span> (Queue / Stack)</li>
<li>Textbook implementation</li>
<li>Extensive tests</li>
<li>Has parent pointers and therefore faster delete_node and constant time replace_node</li>
<li>Composable</li>
<li>Readable</li>
<li>Generic</li>
<li>C99</li>
<li>Easy to use, a bit complex to extend because it is generic</li>
<li>By Jean-Louis Fuchs &lt;<a href="mailto:jean-louis.fuchs@adfinis.com">jean-louis.fuchs@adfinis.com</a>&gt;</li>
<li>Based on Introduction To Algorithms</li>
<li>Text review by Eva Fuchs</li>
<li>Code review by Oliver Sauder @sliverc</li>
<li>Thanks a lot to both</li>
</ul>
<h1 id="installation">Installation</h1>
<p>Copy rbtree.h into your source.</p>
<h1 id="changes">Changes</h1>
<h2 id="section">0.3 -&gt; 0.4</h2>
<ul class="incremental">
<li>Correctly enable cppcheck</li>
<li>Fix style errors reported by cppcheck</li>
<li>Fix bad asserts in performance tests</li>
</ul>
<h2 id="section-1">0.4 -&gt; 0.5</h2>
<ul class="incremental">
<li>Remove static from functions (its a bad habit)</li>
<li>Typos</li>
</ul>
<h2 id="section-2">0.5 -&gt; 0.6</h2>
<ul class="incremental">
<li>Use same code-guidelines as libchirp</li>
<li>Allow msgpack or umsgpack in mpipe.py</li>
</ul>
<h2 id="section-3">0.6 -&gt; 0.7</h2>
<ul class="incremental">
<li>Remove next from _qs_queue_bind_decl_tr_m and renaming it to qs_queue_bind_decl_m</li>
<li>Document bind shortcuts for rb and qs</li>
</ul>
<h2 id="section-4">0.7 -&gt; 0.8</h2>
<ul class="incremental">
<li>Remove non-ascii chars from source</li>
</ul>
<h2 id="requirements">Requirements</h2>
<ul class="incremental">
<li>C99, eg. gcc or clang</li>
</ul>
<h1 id="usage">Usage</h1>
<h2 id="getting-started">Getting started</h2>
<p>The example is on github: example.h, example.c</p>
<p>First we have to define the struct we use in the red-black tree (example.h).</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> book_s<span class="op">;</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> book_s <span class="dt">book_t</span><span class="op">;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> book_s <span class="op">{</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span>    isbn<span class="op">[</span><span class="dv">14</span><span class="op">];</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span><span class="op">*</span>   title<span class="op">;</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span><span class="op">*</span>   author<span class="op">;</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span>    color<span class="op">;</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">book_t</span><span class="op">*</span> parent<span class="op">;</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">book_t</span><span class="op">*</span> left<span class="op">;</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">book_t</span><span class="op">*</span> right<span class="op">;</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<p>You can add the fields color, parent, left and right to any existing struct. It is also possible to use different names than the above (see <a href="#Extended">Extended</a>).</p>
<p>Next we have to define the comparator function, since we want to lookup books using the ISBN-number, we compare it using memcmp.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#define bk_cmp_m</span><span class="op">(</span>x<span class="op">,</span><span class="pp"> </span>y<span class="op">)</span><span class="pp"> </span>memcmp<span class="op">(</span>x<span class="op">-&gt;</span>isbn<span class="op">,</span><span class="pp"> </span>y<span class="op">-&gt;</span>isbn<span class="op">,</span><span class="pp"> </span><span class="dv">13</span><span class="op">)</span></span></code></pre></div>
<p>Since rbtree is implemented as macros, using uppercase for macros isn't a good convention, therefore we use the suffix _m to denote macros.</p>
<p>The prefix bk_ is used as convenience, see <a href="#context">context</a>.</p>
<p>Note if you do something like:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#define bk_cmp_m</span><span class="op">(</span>x<span class="op">,</span><span class="pp"> </span>y<span class="op">)</span><span class="pp"> </span><span class="op">(</span>x<span class="op">-&gt;</span>value<span class="pp"> </span><span class="op">-</span><span class="pp"> </span>y<span class="op">-&gt;</span>value<span class="op">)</span></span></code></pre></div>
<p>You may only use values from (MIN_INT / 4) - 1 to (MAX_INT / 4) since rbtree uses a int to store the result. To be safe write the comparator as:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#define rb_safe_cmp_m</span><span class="op">(</span>x<span class="op">,</span><span class="pp"> </span>y<span class="op">)</span><span class="pp"> </span><span class="op">(((</span>x<span class="op">)&gt;(</span>y<span class="op">)</span><span class="pp"> </span><span class="op">?</span><span class="pp"> </span><span class="dv">1</span><span class="pp"> </span><span class="op">:</span><span class="pp"> </span><span class="op">((</span>x<span class="op">)&lt;(</span>y<span class="op">)</span><span class="pp"> </span><span class="op">?</span><span class="pp"> </span><span class="op">-</span><span class="dv">1</span><span class="pp"> </span><span class="op">:</span><span class="pp"> </span><span class="dv">0</span><span class="op">)))</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#define bk_cmp_m</span><span class="op">(</span>x<span class="op">,</span><span class="pp"> </span>y<span class="op">)</span><span class="pp"> </span>rb_safe_cmp_m<span class="op">(</span>x<span class="op">-&gt;</span>value<span class="op">,</span><span class="pp"> </span>y<span class="op">-&gt;</span>value<span class="op">)</span></span></code></pre></div>
<p>rb_safe_cmp_m is provided by rbtree.</p>
<div id="context">
<p>Then we have to declare all the rbtree functions. rbtree uses a concept, I call context, to find functions it needs. For example the rbtree functions look for a macro called $CONTEXT_cmp_m. I developed this concept to make functions composable without being too verbose.</p>
</div>
<div class="sourceCode" id="cb5"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>rb_for_m<span class="op">(</span>bk<span class="op">,</span> tree<span class="op">,</span> bk_iter<span class="op">,</span> bk_elem<span class="op">)</span></span></code></pre></div>
<p>will look for the functions bk_iter_init and bk_iter_next.</p>
<p>rb_bind_decl_m takes the context, bk in this case and the type as arguments.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>rb_bind_decl_m<span class="op">(</span>bk<span class="op">,</span> <span class="dt">book_t</span><span class="op">)</span></span></code></pre></div>
<p>Now we switch to example.c and define all the rbtree functions and the trees root node.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&quot;example.h&quot;</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>rb_bind_impl_m<span class="op">(</span>bk<span class="op">,</span> <span class="dt">book_t</span><span class="op">)</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="dt">book_t</span><span class="op">*</span> tree<span class="op">;</span></span></code></pre></div>
<p>In order to use the tree, we have to initialize it, which actually is assigning <em>bk_nil_ptr</em> to it.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>bk_tree_init<span class="op">(&amp;</span>tree<span class="op">);</span></span></code></pre></div>
<p>Now we can register a book:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>register_book<span class="op">(</span><span class="dt">char</span> isbn<span class="op">[</span><span class="dv">14</span><span class="op">],</span> <span class="dt">char</span><span class="op">*</span> title<span class="op">,</span> <span class="dt">char</span><span class="op">*</span> author<span class="op">)</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">book_t</span><span class="op">*</span> book <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span><span class="dt">book_t</span><span class="op">));</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    bk_node_init<span class="op">(</span>book<span class="op">);</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    book<span class="op">-&gt;</span>title  <span class="op">=</span> title<span class="op">;</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    book<span class="op">-&gt;</span>author <span class="op">=</span> author<span class="op">;</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    memcpy<span class="op">(</span>book<span class="op">-&gt;</span>isbn<span class="op">,</span> isbn<span class="op">,</span> <span class="dv">14</span><span class="op">);</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    bk_insert<span class="op">(&amp;</span>tree<span class="op">,</span> book<span class="op">);</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Note that we pass a double pointer to bk_insert, since it might need to change the root node.</p>
<p>Or we can lookup a book:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>lookup_book<span class="op">(</span><span class="dt">char</span> isbn<span class="op">[</span><span class="dv">14</span><span class="op">])</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">book_t</span><span class="op">*</span> book<span class="op">;</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">book_t</span> key<span class="op">;</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    memcpy<span class="op">(</span>key<span class="op">.</span>isbn<span class="op">,</span> isbn<span class="op">,</span> <span class="dv">14</span><span class="op">);</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    bk_find<span class="op">(</span>tree<span class="op">,</span> <span class="op">&amp;</span>key<span class="op">,</span> <span class="op">&amp;</span>book<span class="op">);</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;ISBN:   </span><span class="sc">%s\n</span><span class="st">Title:  </span><span class="sc">%s\n</span><span class="st">Author: </span><span class="sc">%s\n\n</span><span class="st">&quot;</span><span class="op">,</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>        book<span class="op">-&gt;</span>isbn<span class="op">,</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>        book<span class="op">-&gt;</span>title<span class="op">,</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>        book<span class="op">-&gt;</span>author</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>The <em>key</em> is just another node, we don't have to initialize it, but only set the fields used by the comparator. bk_find will set <em>book</em> to the node found.</p>
<p>We can also iterate over the tree, the result will be sorted, lesser element first. The tree may not be modified during iteration.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>rb_iter_decl_cx_m<span class="op">(</span>bk<span class="op">,</span> bk_iter<span class="op">,</span> bk_elem<span class="op">);</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>rb_for_m<span class="op">(</span>bk<span class="op">,</span> tree<span class="op">,</span> bk_iter<span class="op">,</span> bk_elem<span class="op">)</span> <span class="op">{</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%s\n</span><span class="st">&quot;</span><span class="op">,</span> bk_elem<span class="op">-&gt;</span>isbn<span class="op">);</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Removing a book is straight forward.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>remove_book<span class="op">(</span><span class="dt">book_t</span><span class="op">*</span> book<span class="op">)</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">&quot;Removing </span><span class="sc">%s\n</span><span class="st">&quot;</span><span class="op">,</span> book<span class="op">-&gt;</span>isbn<span class="op">);</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    bk_delete_node<span class="op">(&amp;</span>tree<span class="op">,</span> book<span class="op">);</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    free<span class="op">(</span>book<span class="op">);</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>But we cannot use the iterator. Therefore we just remove the root till the tree is empty.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span><span class="op">(</span>tree <span class="op">!=</span> bk_nil_ptr<span class="op">)</span> <span class="op">{</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    remove_book<span class="op">(</span>tree<span class="op">);</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h2 id="api">API</h2>
<dl class="incremental">
<dt>rb_bind_decl_m(context, type) alias rb_bind_decl_cx_m</dt>
<dd><p>Bind the rbtree function declarations for <em>type</em> to <em>context</em>. Usually used in a header.</p>
</dd>
<dt>rb_bind_impl_m(context, type)</dt>
<dd><p>Bind the rbtree function implementations for <em>type</em> to <em>context</em>. Usually used in a c-file. This variant uses the standard <a href="">rb</a>*_m traits.</p>
</dd>
<dt>rb_bind_impl_cx_m(context, type)</dt>
<dd><p>Bind the rbtree function implementations for <em>type</em> to <em>context</em>. Usually used in a c-file. This variant uses cx##_*_m traits, which means you have to define them.</p>
</dd>
<dt>rb_bind_cx_m/rb_bind_m(context, type)</dt>
<dd><p>Shortcut to bind declaration and implementation at once.</p>
</dd>
<dt>rb_safe_value_cmp_m(x, y)</dt>
<dd><p>Basis for safe value comparators. <em>x</em> and <em>y</em> are comparable values of the same type.</p>
</dd>
</dl>
<p>Then the following functions will be available.</p>
<dl class="incremental">
<dt>cx##_tree_init(type* tree)</dt>
<dd><p>Initialize <em>tree</em> by assigning <em>cx##_nil_ptr</em> to it.</p>
</dd>
<dt>cx##_node_init(type* node)</dt>
<dd><p>Initialize <em>node</em> by initializing the color, parent, left and right fields.</p>
</dd>
<dt>cx##_insert(type** tree, type* node)</dt>
<dd><p>Insert <em>node</em> into <em>tree</em>. If a node with the same key exists the function returns 1 and <em>node</em> is not inserted, 0 on success.</p>
</dd>
<dt>cx##_delete_node(type** tree, type* node)</dt>
<dd><p>Delete the known <em>node</em> from <em>tree</em>.</p>
</dd>
<dt>cx##_delete(type** tree, type* key, type** node)</dt>
<dd><p>Delete the node matching <em>key</em> from <em>tree</em>. If <em>key</em> is not in the tree the function returns 1, 0 on success. On success <em>node</em> is set to the deleted node.</p>
</dd>
<dt>cx##_replace_node(type** tree, type* old, type* new)</dt>
<dd><p>Replace known node <em>old</em> with <em>new</em>. If <em>old</em> and <em>new</em> are not equal the function will not do anything and returns 1, 0 on success.</p>
</dd>
<dt>cx##_replace(type** tree, type* key, type* new, type** old)</dt>
<dd><p>Replace the node matching <em>key</em> with <em>new</em>. If <em>key</em> and <em>new</em> are not equal the function will not do anything and returns 1. If <em>key</em> is not in the tree the function will not do anything and returns 1. It returns 0 on success. On success <em>old</em> is set to the old node.</p>
</dd>
<dt>cx##_find(type* tree, type* key, type** node)</dt>
<dd><p>Find the node matching <em>key</em> and assign it to <em>node</em>. If <em>key</em> is not in the tree <em>node</em> will not be assigned and the function returns 1, 0 on success.</p>
</dd>
<dt>cx##_size(type* tree)</dt>
<dd><p>Returns the size of tree. By default RB_SIZE_T is int to avoid additional dependencies. Feel free to define RB_SIZE_T as size_t for example. O(log (N)).</p>
</dd>
<dt>rb_iter_decl_m(cx, iter, elem)</dt>
<dd><p>Declares the variables <em>iter</em> and <em>elem</em> for the context <em>cx</em>.</p>
</dd>
<dt>cx##_iter_init(type* tree, cx##_iter_t* iter, type** elem)</dt>
<dd><p>Initializes <em>elem</em> to point to the first element in tree. Use rb_iter_decl_m to declare <em>iter</em> and <em>elem</em>. If the tree is empty <em>elem</em> will be NULL.</p>
</dd>
<dt>cx##_iter_next(cx##_iter_t* iter, type** elem)</dt>
<dd><p>Move <em>elem</em> to the next element in the tree. <em>elem</em> will point to NULL at the end.</p>
</dd>
<dt>cx##_check_tree(type* tree)</dt>
<dd><p>Check the consistency of a tree. Only interesting for development of rbtree itself. If will fail with an assert if there is an inconsistency.</p>
</dd>
</dl>
<h2 id="extended">Extended</h2>
<div id="Extended">
<p>Many functions x come in two flavors</p>
</div>
<dl class="incremental">
<dt>cx_x</dt>
<dd><p>These functions are bound to a type. Traits and the comparator are mapped to the context. You have to define the type and the traits for the context and then you bind the function.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#define my_color_m</span><span class="op">(</span>x<span class="op">)</span><span class="pp"> </span><span class="op">(</span>x<span class="op">)-&gt;</span>color</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#define my_parent_m</span><span class="op">(</span>x<span class="op">)</span><span class="pp"> </span><span class="op">(</span>x<span class="op">)-&gt;</span>parent</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#define my_left_m</span><span class="op">(</span>x<span class="op">)</span><span class="pp"> </span><span class="op">(</span>x<span class="op">)-&gt;</span>left</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#define my_right_m</span><span class="op">(</span>x<span class="op">)</span><span class="pp"> </span><span class="op">(</span>x<span class="op">)-&gt;</span>right</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#define my_cmp_m</span><span class="op">(</span>x<span class="op">,</span><span class="pp"> </span>y<span class="op">)</span><span class="pp"> </span>rb_safe_value_cmp_m<span class="op">(</span>x<span class="op">,</span><span class="pp"> </span>y<span class="op">)</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>rb_bind_cx_m<span class="op">(</span>my<span class="op">,</span> <span class="dt">node_t</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>my_tree_init<span class="op">(&amp;</span>tree<span class="op">);</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>my_node_init<span class="op">(</span>node<span class="op">);</span></span></code></pre></div>
<p>There is also a shortcut if you know your are going to use all standard fields in your struct (color, parent, left right)</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#define my_cmp_m</span><span class="op">(</span>x<span class="op">,</span><span class="pp"> </span>y<span class="op">)</span><span class="pp"> </span>rb_safe_value_cmp_m<span class="op">(</span>x<span class="op">,</span><span class="pp"> </span>y<span class="op">)</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>rb_bind_m<span class="op">(</span>my<span class="op">,</span> <span class="dt">node_t</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>my_tree_init<span class="op">(&amp;</span>tree<span class="op">);</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>my_node_init<span class="op">(</span>node<span class="op">);</span></span></code></pre></div>
<p>Of course usually, you want to split declaration and implementation of the function, so it is: header.h:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#define my_cmp_m</span><span class="op">(</span>x<span class="op">,</span><span class="pp"> </span>y<span class="op">)</span><span class="pp"> </span>rb_safe_value_cmp_m<span class="op">(</span>x<span class="op">,</span><span class="pp"> </span>y<span class="op">)</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>rb_bind_decl_m<span class="op">(</span>my<span class="op">,</span> <span class="dt">node_t</span><span class="op">)</span></span></code></pre></div>
<p>And object.c:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&quot;header.h&quot;</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>rb_bind_impl_m<span class="op">(</span>my<span class="op">,</span> <span class="dt">node_t</span><span class="op">)</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span> my_node_init<span class="op">(</span>node<span class="op">);</span> <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span> <span class="op">}</span></span></code></pre></div>
</dd>
<dt>rb_x_m</dt>
<dd><p>These functions are macros and take a type and traits as standard arguments and are the most verbose. Used to extend rbtree.</p>
<p>To use the rb_x_m functions you also need to initialize the nil pointer.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>tree <span class="op">=</span> my_nil_ptr<span class="op">;</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>rb_node_init_m<span class="op">(</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    my_nil_ptr<span class="op">,</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    rb_color_m<span class="op">,</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    rb_parent_m<span class="op">,</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    rb_left_m<span class="op">,</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    rb_right_m<span class="op">,</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    my_nil_ptr</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="op">);</span> <span class="co">// Instead of my_tree_init in the bound functions</span></span></code></pre></div>
</dd>
</dl>
<h1 id="performance">Performance</h1>
<p>I compare with <a href="http://sglib.sourceforge.net/">sglib</a>, because it is the best and greatest I know. Kudos to Marian Vittek. rbtree has similar performance.</p>
<h1 id="code-size">Code size</h1>
<pre class="text"><code>0x018 T my_node_init
0x01b T my_tree_init
0x020 C my_nil_mem
0x02d T my_size
0x032 T my_iter_init
0x03d T my_find
0x042 T my_check_tree
0x043 T my_check_tree_rec
0x048 T my_iter_next
0x05d T my_replace
0x060 T my_delete
0x08b T my_replace_node
0x20e T my_insert
0x356 T my_delete_node</code></pre>
<p>About 2100 bytes. If NDEBUG or RB_NO_CHECK is defined the my_check_tree and my_check_tree_rec will be removed.</p>
<p>Also _rb_rotate_left_m could be bound and called by delete and insert. But in my opinion 2100 bytes is small.</p>
<h1 id="implementation">Implementation</h1>
<p>Based on Introduction to Algorithms: <a href="https://mitpress.mit.edu/books/introduction-algorithms">official</a>, <a href="https://en.wikipedia.org/wiki/Introduction_to_Algorithms">wiki</a>, <a href="http://staff.ustc.edu.cn/~csli/graduate/algorithms/book6/chap14.htm">web</a>, <a href="http://www.realtechsupport.org/UB/SR/algorithms/Cormen_Algorithms_3rd.pdf">pdf</a> and <a href="https://archive.org/details/IntroductionToAlgorithms3edCorman_201508">archive</a>.</p>
<h2 id="properties">Properties</h2>
<p>A binary search tree is a red-black tree if it satisfies the following red-black properties:</p>
<ol class="incremental" type="1">
<li>Every node is either red or black.</li>
<li>Every leaf (NIL) is black.</li>
<li>If a node is red, then both its children are black.</li>
<li>Every simple path from a node to a descendant leaf contains the same number of black nodes.</li>
</ol>
<p>In order to understand the deletion, the concept of double (extra) blackness is introduced. If a black node was deleted its blackness is pushed down and a child can become extra black. This is the way property 1 can be violated.</p>
<h1 id="definitions">Definitions</h1>
<p>RB_SIZE_T can be defined by the user to use size_t for example.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#ifndef rb_tree_h</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#define rb_tree_h</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;assert.h&gt;</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#ifndef RB_SIZE_T</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#define RB_SIZE_T </span><span class="dt">int</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="pp">#ifdef NDEBUG</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="pp">#define RB_NO_CHECK</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span></code></pre></div>
<h1 id="basic-traits">Basic traits</h1>
<p>Traits used by default (rb_x_m macros)</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#define rb_color_m</span><span class="op">(</span>x<span class="op">)</span><span class="pp"> </span><span class="op">(</span>x<span class="op">)-&gt;</span>color</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#define rb_parent_m</span><span class="op">(</span>x<span class="op">)</span><span class="pp"> </span><span class="op">(</span>x<span class="op">)-&gt;</span>parent</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#define rb_left_m</span><span class="op">(</span>x<span class="op">)</span><span class="pp"> </span><span class="op">(</span>x<span class="op">)-&gt;</span>left</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#define rb_right_m</span><span class="op">(</span>x<span class="op">)</span><span class="pp"> </span><span class="op">(</span>x<span class="op">)-&gt;</span>right</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#define rb_value_m</span><span class="op">(</span>x<span class="op">)</span><span class="pp"> </span><span class="op">(</span>x<span class="op">)-&gt;</span>value</span></code></pre></div>
<h1 id="context-creation">Context creation</h1>
<p>Create the type aliases. Actually only cx##_iter_t is used, since we can just refer to <em>type</em>. Note the const before cx##_nil_ptr, is the secret to make the code so small: the compiler just inserts the value into all comparisons with nil.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#define rb_new_context_m</span><span class="op">(</span>cx<span class="op">,</span><span class="pp"> </span>type<span class="op">)</span><span class="pp">                                             </span><span class="op">\</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="kw">typedef</span><span class="pp"> </span>type<span class="pp">              </span>cx<span class="pp">##</span>_type_t<span class="op">;</span><span class="pp">                                     </span><span class="op">\</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="kw">typedef</span><span class="pp"> </span>type<span class="pp">              </span>cx<span class="pp">##</span>_iter_t<span class="op">;</span><span class="pp">                                     </span><span class="op">\</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="at">extern</span><span class="pp"> </span>cx<span class="pp">##</span>_type_t<span class="op">*</span><span class="pp"> </span><span class="at">const</span><span class="pp"> </span>cx<span class="pp">##</span>_nil_ptr<span class="op">;</span></span></code></pre></div>
<h1 id="comparators">Comparators</h1>
<p>Some basic comparators, you would usually define your own.</p>
<h2 id="rb_safe_cmp_m">rb_safe_cmp_m</h2>
<p>Base for safe value comparators.</p>
<dl class="incremental">
<dt>x, y</dt>
<dd><p>Values to compare</p>
</dd>
</dl>
<div class="sourceCode" id="cb25"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#define rb_safe_cmp_m</span><span class="op">(</span>x<span class="op">,</span><span class="pp"> </span>y<span class="op">)</span><span class="pp"> </span><span class="op">(((</span>x<span class="op">)</span><span class="pp"> </span><span class="op">&gt;</span><span class="pp"> </span><span class="op">(</span>y<span class="op">)</span><span class="pp"> </span><span class="op">?</span><span class="pp"> </span><span class="dv">1</span><span class="pp"> </span><span class="op">:</span><span class="pp"> </span><span class="op">((</span>x<span class="op">)</span><span class="pp"> </span><span class="op">&lt;</span><span class="pp"> </span><span class="op">(</span>y<span class="op">)</span><span class="pp"> </span><span class="op">?</span><span class="pp"> </span><span class="op">-</span><span class="dv">1</span><span class="pp"> </span><span class="op">:</span><span class="pp"> </span><span class="dv">0</span><span class="op">)))</span></span></code></pre></div>
<h2 id="rb_pointer_cmp_m">rb_pointer_cmp_m</h2>
<p>Compares pointers.</p>
<dl class="incremental">
<dt>x, y</dt>
<dd><p>Nodes to compare</p>
</dd>
</dl>
<div class="sourceCode" id="cb26"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#define rb_pointer_cmp_m</span><span class="op">(</span>x<span class="op">,</span><span class="pp"> </span>y<span class="op">)</span><span class="pp"> </span>rb_safe_cmp_m<span class="op">(</span>x<span class="op">,</span><span class="pp"> </span>y<span class="op">)</span></span></code></pre></div>
<h2 id="rb_safe_value_cmp_m">rb_safe_value_cmp_m</h2>
<p>Safe value comparator. Compares nodes that have the rb_value_m trait.</p>
<dl class="incremental">
<dt>x, y</dt>
<dd><p>Nodes to compare</p>
</dd>
</dl>
<div class="sourceCode" id="cb27"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#define rb_safe_value_cmp_m</span><span class="op">(</span>x<span class="op">,</span><span class="pp"> </span>y<span class="op">)</span><span class="pp"> </span>rb_safe_cmp_m<span class="op">(</span>rb_value_m<span class="op">(</span>x<span class="op">),</span><span class="pp"> </span>rb_value_m<span class="op">(</span>y<span class="op">))</span></span></code></pre></div>
<h2 id="rb_value_cmp_m">rb_value_cmp_m</h2>
<p>Compares nodes that have the rb_value_m trait. Only safe if you only use 30bit values.</p>
<dl class="incremental">
<dt>x, y</dt>
<dd><p>Nodes to compare</p>
</dd>
</dl>
<div class="sourceCode" id="cb28"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#define rb_value_cmp_m</span><span class="op">(</span>x<span class="op">,</span><span class="pp"> </span>y<span class="op">)</span><span class="pp"> </span><span class="op">(</span>rb_value_m<span class="op">(</span>x<span class="op">)</span><span class="pp"> </span><span class="op">-</span><span class="pp"> </span>rb_value_m<span class="op">(</span>y<span class="op">))</span></span></code></pre></div>
<h1 id="colors">Colors</h1>
<p>The obvious colors.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#define RB_BLACK </span><span class="dv">0</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#define RB_RED </span><span class="dv">1</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#define rb_is_black_m</span><span class="op">(</span>x<span class="op">)</span><span class="pp"> </span><span class="op">(</span>x<span class="pp"> </span><span class="op">==</span><span class="pp"> </span>RB_BLACK<span class="op">)</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#define rb_is_red_m</span><span class="op">(</span>x<span class="op">)</span><span class="pp"> </span><span class="op">(</span>x<span class="pp"> </span><span class="op">==</span><span class="pp"> </span>RB_RED<span class="op">)</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="pp">#define rb_make_black_m</span><span class="op">(</span>x<span class="op">)</span><span class="pp"> </span>x<span class="pp"> </span><span class="op">=</span><span class="pp"> </span>RB_BLACK</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="pp">#define rb_make_red_m</span><span class="op">(</span>x<span class="op">)</span><span class="pp"> </span>x<span class="pp"> </span><span class="op">=</span><span class="pp"> </span>RB_RED</span></code></pre></div>
<h1 id="api-1">API</h1>
<p>Functions that are part of the API. The standard arguments are documented once:</p>
<dl class="incremental">
<dt>type</dt>
<dd><p>The type of the nodes in the red-black tree.</p>
</dd>
<dt>nil</dt>
<dd><p>A pointer to the nil object.</p>
</dd>
<dt>color</dt>
<dd><p>The color trait of the nodes in the rbtree.</p>
</dd>
<dt>parent</dt>
<dd><p>The parent trait of the nodes in the rbtree is a pointer back to the parent node.</p>
</dd>
<dt>left</dt>
<dd><p>The left trait of the nodes in the rbtree is a pointer to the left branch of the node.</p>
</dd>
<dt>right</dt>
<dd><p>The right trait of the nodes in the rbtree is a pointer to the right branch of the node.</p>
</dd>
</dl>
<h2 id="rb_node_init_m">rb_node_init_m</h2>
<p>Bound: cx##_node_init</p>
<p>Initializes a node by setting the color to black and all pointers to nil.</p>
<dl class="incremental">
<dt>node</dt>
<dd><p>The node to initialize.</p>
</dd>
</dl>
<div class="sourceCode" id="cb30"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#define rb_node_init_m</span><span class="op">(</span>nil<span class="op">,</span><span class="pp"> </span>color<span class="op">,</span><span class="pp"> </span>parent<span class="op">,</span><span class="pp"> </span>left<span class="op">,</span><span class="pp"> </span>right<span class="op">,</span><span class="pp"> </span>node<span class="op">)</span><span class="pp">                  </span><span class="op">\</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="op">{</span><span class="pp">                                                                          </span><span class="op">\</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>color<span class="op">(</span>node<span class="op">)</span><span class="pp">  </span><span class="op">=</span><span class="pp"> </span>RB_BLACK<span class="op">;</span><span class="pp">                                               </span><span class="op">\</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>parent<span class="op">(</span>node<span class="op">)</span><span class="pp"> </span><span class="op">=</span><span class="pp"> </span>nil<span class="op">;</span><span class="pp">                                                    </span><span class="op">\</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>left<span class="op">(</span>node<span class="op">)</span><span class="pp">   </span><span class="op">=</span><span class="pp"> </span>nil<span class="op">;</span><span class="pp">                                                    </span><span class="op">\</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>right<span class="op">(</span>node<span class="op">)</span><span class="pp">  </span><span class="op">=</span><span class="pp"> </span>nil<span class="op">;</span><span class="pp">                                                    </span><span class="op">\</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="op">}</span></span></code></pre></div>
<h2 id="rb_for_m">rb_for_m</h2>
<p>Generates a for-loop-header using the iterator.</p>
<dl class="incremental">
<dt>iter</dt>
<dd><p>The new iterator variable.</p>
</dd>
<dt>elem</dt>
<dd><p>The pointer to the current element.</p>
</dd>
</dl>
<div class="sourceCode" id="cb31"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#define rb_for_m</span><span class="op">(</span>cx<span class="op">,</span><span class="pp"> </span>tree<span class="op">,</span><span class="pp"> </span>iter<span class="op">,</span><span class="pp"> </span>elem<span class="op">)</span><span class="pp">                                         </span><span class="op">\</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="cf">for</span><span class="pp"> </span><span class="op">(</span>cx<span class="pp">##</span>_iter_init<span class="op">(</span>tree<span class="op">,</span><span class="pp"> </span><span class="op">&amp;</span>iter<span class="op">,</span><span class="pp"> </span><span class="op">&amp;</span>elem<span class="op">);</span><span class="pp"> </span>elem<span class="pp"> </span><span class="op">!=</span><span class="pp"> </span>NULL<span class="op">;</span><span class="pp">                     </span><span class="op">\</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="pp">         </span>cx<span class="pp">##</span>_iter_next<span class="op">(</span>iter<span class="op">,</span><span class="pp"> </span><span class="op">&amp;</span>elem<span class="op">))</span></span></code></pre></div>
<h2 id="rb_iter_decl_m">rb_iter_decl_m</h2>
<p>Also: rb_iter_decl_cx_m</p>
<p>Declare iterator variables.</p>
<dl class="incremental">
<dt>iter</dt>
<dd><p>The new iterator variable.</p>
</dd>
<dt>elem</dt>
<dd><p>The pointer to the current element.</p>
</dd>
</dl>
<div class="sourceCode" id="cb32"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#define rb_iter_decl_m</span><span class="op">(</span>type<span class="op">,</span><span class="pp"> </span>iter<span class="op">,</span><span class="pp"> </span>elem<span class="op">)</span><span class="pp">                                       </span><span class="op">\</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span>type<span class="op">*</span><span class="pp"> </span>iter<span class="pp"> </span><span class="op">=</span><span class="pp"> </span>NULL<span class="op">;</span><span class="pp">                                                         </span><span class="op">\</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span>type<span class="op">*</span><span class="pp"> </span>elem<span class="pp"> </span><span class="op">=</span><span class="pp"> </span>NULL<span class="op">;</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#define rb_iter_decl_cx_m</span><span class="op">(</span>cx<span class="op">,</span><span class="pp"> </span>iter<span class="op">,</span><span class="pp"> </span>elem<span class="op">)</span><span class="pp">                                      </span><span class="op">\</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span>cx<span class="pp">##</span>_type_t<span class="op">*</span><span class="pp"> </span>iter<span class="pp"> </span><span class="op">=</span><span class="pp"> </span>NULL<span class="op">;</span><span class="pp">                                                  </span><span class="op">\</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span>cx<span class="pp">##</span>_type_t<span class="op">*</span><span class="pp"> </span>elem<span class="pp"> </span><span class="op">=</span><span class="pp"> </span>NULL<span class="op">;</span></span></code></pre></div>
<h2 id="rb_iter_init_m">rb_iter_init_m</h2>
<p>Bound: cx##_iter_init</p>
<p>Initialize iterator. It will point to the first element.</p>
<dl class="incremental">
<dt>tree</dt>
<dd><p>The root node of the tree. A pointer to nil represents an empty tree.</p>
</dd>
<dt>iter</dt>
<dd><p>The iterator.</p>
</dd>
<dt>elem</dt>
<dd><p>The pointer to the current element. Is NULL if the tree is empty.</p>
</dd>
</dl>
<div class="sourceCode" id="cb33"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#define rb_iter_init_m</span><span class="op">(</span>nil<span class="op">,</span><span class="pp"> </span>left<span class="op">,</span><span class="pp"> </span>tree<span class="op">,</span><span class="pp"> </span>elem<span class="op">)</span><span class="pp">                                  </span><span class="op">\</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="op">{</span><span class="pp">                                                                          </span><span class="op">\</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="cf">if</span><span class="pp"> </span><span class="op">(</span>tree<span class="pp"> </span><span class="op">==</span><span class="pp"> </span>nil<span class="op">)</span><span class="pp"> </span><span class="op">{</span><span class="pp">                                                     </span><span class="op">\</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>elem<span class="pp"> </span><span class="op">=</span><span class="pp"> </span>NULL<span class="op">;</span><span class="pp">                                                       </span><span class="op">\</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="op">}</span><span class="pp"> </span><span class="cf">else</span><span class="pp"> </span><span class="op">{</span><span class="pp">                                                               </span><span class="op">\</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>elem<span class="pp"> </span><span class="op">=</span><span class="pp"> </span>tree<span class="op">;</span><span class="pp">                                                       </span><span class="op">\</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="cf">while</span><span class="pp"> </span><span class="op">(</span>left<span class="op">(</span>elem<span class="op">)</span><span class="pp"> </span><span class="op">!=</span><span class="pp"> </span>nil<span class="op">)</span><span class="pp">                                          </span><span class="op">\</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>elem<span class="pp"> </span><span class="op">=</span><span class="pp"> </span>left<span class="op">(</span>elem<span class="op">);</span><span class="pp">                                             </span><span class="op">\</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="op">}</span><span class="pp">                                                                      </span><span class="op">\</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="cf">if</span><span class="pp"> </span><span class="op">(</span>elem<span class="pp"> </span><span class="op">==</span><span class="pp"> </span>nil<span class="op">)</span><span class="pp"> </span><span class="op">{</span><span class="pp">                                                     </span><span class="op">\</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>elem<span class="pp"> </span><span class="op">=</span><span class="pp"> </span>NULL<span class="op">;</span><span class="pp">                                                       </span><span class="op">\</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="op">}</span><span class="pp">                                                                      </span><span class="op">\</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="op">}</span></span></code></pre></div>
<h2 id="rb_iter_next_m">rb_iter_next_m</h2>
<p>Bound: cx##_iter_next</p>
<p>Initialize iterator. It will point to the first element. The element will be NULL, if the iteration is at the end.</p>
<dl class="incremental">
<dt>elem</dt>
<dd><p>The pointer to the current element.</p>
</dd>
</dl>
<div class="sourceCode" id="cb34"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#define _rb_iter_next_m</span><span class="op">(</span>nil<span class="op">,</span><span class="pp"> </span>parent<span class="op">,</span><span class="pp"> </span>left<span class="op">,</span><span class="pp"> </span>right<span class="op">,</span><span class="pp"> </span>elem<span class="op">,</span><span class="pp"> </span>tmp<span class="op">)</span><span class="pp">                   </span><span class="op">\</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="cf">do</span><span class="pp"> </span><span class="op">{</span><span class="pp">                                                                       </span><span class="op">\</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>tmp<span class="pp"> </span><span class="op">=</span><span class="pp"> </span>right<span class="op">(</span>elem<span class="op">);</span><span class="pp">                                                     </span><span class="op">\</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="cf">if</span><span class="pp"> </span><span class="op">(</span>tmp<span class="pp"> </span><span class="op">!=</span><span class="pp"> </span>nil<span class="op">)</span><span class="pp"> </span><span class="op">{</span><span class="pp">                                                      </span><span class="op">\</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>elem<span class="pp"> </span><span class="op">=</span><span class="pp"> </span>tmp<span class="op">;</span><span class="pp">                                                        </span><span class="op">\</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="cf">while</span><span class="pp"> </span><span class="op">(</span>left<span class="op">(</span>elem<span class="op">)</span><span class="pp"> </span><span class="op">!=</span><span class="pp"> </span>nil<span class="op">)</span><span class="pp">                                          </span><span class="op">\</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>elem<span class="pp"> </span><span class="op">=</span><span class="pp"> </span>left<span class="op">(</span>elem<span class="op">);</span><span class="pp">                                             </span><span class="op">\</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="cf">break</span><span class="op">;</span><span class="pp">                                                             </span><span class="op">\</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="op">}</span><span class="pp">                                                                      </span><span class="op">\</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="cf">for</span><span class="pp"> </span><span class="op">(;;)</span><span class="pp"> </span><span class="op">{</span><span class="pp">                                                             </span><span class="op">\</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="co">/* Next would be the root, we are done. */</span><span class="pp">                         </span><span class="op">\</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="cf">if</span><span class="pp"> </span><span class="op">(</span>parent<span class="op">(</span>elem<span class="op">)</span><span class="pp"> </span><span class="op">==</span><span class="pp"> </span>nil<span class="op">)</span><span class="pp"> </span><span class="op">{</span><span class="pp">                                         </span><span class="op">\</span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>elem<span class="pp"> </span><span class="op">=</span><span class="pp"> </span>NULL<span class="op">;</span><span class="pp">                                                   </span><span class="op">\</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span><span class="cf">break</span><span class="op">;</span><span class="pp">                                                         </span><span class="op">\</span></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="op">}</span><span class="pp">                                                                  </span><span class="op">\</span></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>tmp<span class="pp"> </span><span class="op">=</span><span class="pp"> </span>parent<span class="op">(</span>elem<span class="op">);</span><span class="pp">                                                </span><span class="op">\</span></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="co">/* tmp is a left node, therefore it is the next node. */</span><span class="pp">           </span><span class="op">\</span></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="cf">if</span><span class="pp"> </span><span class="op">(</span>elem<span class="pp"> </span><span class="op">==</span><span class="pp"> </span>left<span class="op">(</span>tmp<span class="op">))</span><span class="pp"> </span><span class="op">{</span><span class="pp">                                           </span><span class="op">\</span></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>elem<span class="pp"> </span><span class="op">=</span><span class="pp"> </span>tmp<span class="op">;</span><span class="pp">                                                    </span><span class="op">\</span></span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span><span class="cf">break</span><span class="op">;</span><span class="pp">                                                         </span><span class="op">\</span></span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="op">}</span><span class="pp">                                                                  </span><span class="op">\</span></span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>elem<span class="pp"> </span><span class="op">=</span><span class="pp"> </span>tmp<span class="op">;</span><span class="pp">                                                        </span><span class="op">\</span></span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="op">}</span><span class="pp">                                                                      </span><span class="op">\</span></span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="op">}</span><span class="pp"> </span><span class="cf">while</span><span class="pp"> </span><span class="op">(</span><span class="dv">0</span><span class="op">)</span></span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a><span class="pp">#define rb_iter_next_m</span><span class="op">(</span>nil<span class="op">,</span><span class="pp"> </span>type<span class="op">,</span><span class="pp"> </span>parent<span class="op">,</span><span class="pp"> </span>left<span class="op">,</span><span class="pp"> </span>right<span class="op">,</span><span class="pp"> </span>elem<span class="op">)</span><span class="pp">                   </span><span class="op">\</span></span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="op">{</span><span class="pp">                                                                          </span><span class="op">\</span></span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>type<span class="op">*</span><span class="pp"> </span>__rb_next_tmp_<span class="op">;</span><span class="pp">                                                  </span><span class="op">\</span></span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>_rb_iter_next_m<span class="op">(</span>nil<span class="op">,</span><span class="pp"> </span>parent<span class="op">,</span><span class="pp"> </span>left<span class="op">,</span><span class="pp"> </span>right<span class="op">,</span><span class="pp"> </span>elem<span class="op">,</span><span class="pp"> </span>__rb_next_tmp_<span class="op">);</span><span class="pp">       </span><span class="op">\</span></span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="op">}</span></span></code></pre></div>
<h2 id="rb_insert_m">rb_insert_m</h2>
<p>Bound: cx##_insert</p>
<p>Insert the node into the tree. This function might replace the root node (<em>tree</em>). If an equal node exists in the tree, the node will not be added and will still be in its initialized state.</p>
<p>The bound function will return 0 on success.</p>
<dl class="incremental">
<dt>cmp</dt>
<dd><p>Comparator (rb_pointer_cmp_m or rb_safe_value_cmp_m could be used)</p>
</dd>
<dt>tree</dt>
<dd><p>The root node of the tree. A pointer to nil represents an empty tree.</p>
</dd>
<dt>node</dt>
<dd><p>The node to insert.</p>
</dd>
</dl>
<div class="sourceCode" id="cb35"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#define _rb_insert_m</span><span class="op">(</span><span class="pp">                                                          </span><span class="op">\</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>type<span class="op">,</span><span class="pp">                                                                  </span><span class="op">\</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>nil<span class="op">,</span><span class="pp">                                                                   </span><span class="op">\</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>color<span class="op">,</span><span class="pp">                                                                 </span><span class="op">\</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>parent<span class="op">,</span><span class="pp">                                                                </span><span class="op">\</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>left<span class="op">,</span><span class="pp">                                                                  </span><span class="op">\</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>right<span class="op">,</span><span class="pp">                                                                 </span><span class="op">\</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>cmp<span class="op">,</span><span class="pp">                                                                   </span><span class="op">\</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>tree<span class="op">,</span><span class="pp">                                                                  </span><span class="op">\</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>node<span class="op">,</span><span class="pp">                                                                  </span><span class="op">\</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>c<span class="op">,</span><span class="pp"> </span><span class="co">/* current */</span><span class="pp">                                                       </span><span class="op">\</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>p<span class="op">,</span><span class="pp"> </span><span class="co">/* parent */</span><span class="pp">                                                        </span><span class="op">\</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>r<span class="pp">  </span><span class="co">/* result */</span><span class="pp">                                                        </span><span class="op">\</span></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a><span class="op">)</span><span class="pp">                                                                              </span><span class="op">\</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="cf">do</span><span class="pp"> </span><span class="op">{</span><span class="pp">                                                                       </span><span class="op">\</span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="ot">assert</span><span class="op">(</span>tree<span class="pp"> </span><span class="op">!=</span><span class="pp"> </span>NULL<span class="pp"> </span><span class="op">&amp;&amp;</span><span class="pp"> </span><span class="st">&quot;Tree was not initialized&quot;</span><span class="op">);</span><span class="pp">                    </span><span class="op">\</span></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="ot">assert</span><span class="op">(</span>node<span class="pp"> </span><span class="op">!=</span><span class="pp"> </span>nil<span class="pp"> </span><span class="op">&amp;&amp;</span><span class="pp"> </span><span class="st">&quot;Cannot insert nil node&quot;</span><span class="op">);</span><span class="pp">                       </span><span class="op">\</span></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="ot">assert</span><span class="op">(</span>node<span class="pp"> </span><span class="op">!=</span><span class="pp"> </span>nil<span class="pp"> </span><span class="op">&amp;&amp;</span><span class="pp"> </span><span class="st">&quot;Cannot insert nil node&quot;</span><span class="op">);</span><span class="pp">                       </span><span class="op">\</span></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="ot">assert</span><span class="op">(</span>parent<span class="op">(</span>node<span class="op">)</span><span class="pp"> </span><span class="op">==</span><span class="pp"> </span>nil<span class="pp"> </span><span class="op">&amp;&amp;</span><span class="pp"> </span>left<span class="op">(</span>node<span class="op">)</span><span class="pp"> </span><span class="op">==</span><span class="pp"> </span>nil<span class="pp"> </span><span class="op">&amp;&amp;</span><span class="pp">                     </span><span class="op">\</span></span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a><span class="pp">               </span>right<span class="op">(</span>node<span class="op">)</span><span class="pp"> </span><span class="op">==</span><span class="pp"> </span>nil<span class="pp"> </span><span class="op">&amp;&amp;</span><span class="pp"> </span>tree<span class="pp"> </span><span class="op">!=</span><span class="pp"> </span>node<span class="pp"> </span><span class="op">&amp;&amp;</span><span class="pp">                           </span><span class="op">\</span></span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a><span class="pp">               </span><span class="st">&quot;Node already used or not initialized&quot;</span><span class="op">);</span><span class="pp">                        </span><span class="op">\</span></span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="cf">if</span><span class="pp"> </span><span class="op">(</span>tree<span class="pp"> </span><span class="op">==</span><span class="pp"> </span>nil<span class="op">)</span><span class="pp"> </span><span class="op">{</span><span class="pp">                                                     </span><span class="op">\</span></span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>tree<span class="pp"> </span><span class="op">=</span><span class="pp"> </span>node<span class="op">;</span><span class="pp">                                                       </span><span class="op">\</span></span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>rb_make_black_m<span class="op">(</span>color<span class="op">(</span>tree<span class="op">));</span><span class="pp">                                      </span><span class="op">\</span></span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="cf">break</span><span class="op">;</span><span class="pp">                                                             </span><span class="op">\</span></span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="op">}</span><span class="pp"> </span><span class="cf">else</span><span class="pp"> </span><span class="op">{</span><span class="pp">                                                               </span><span class="op">\</span></span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="ot">assert</span><span class="op">((</span>parent<span class="op">(</span>tree<span class="op">)</span><span class="pp"> </span><span class="op">==</span><span class="pp"> </span>nil<span class="pp"> </span><span class="op">&amp;&amp;</span><span class="pp"> </span>rb_is_black_m<span class="op">(</span>color<span class="op">(</span>tree<span class="op">)))</span><span class="pp"> </span><span class="op">&amp;&amp;</span><span class="pp">      </span><span class="op">\</span></span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a><span class="pp">                   </span><span class="st">&quot;Tree is not root&quot;</span><span class="op">);</span><span class="pp">                                        </span><span class="op">\</span></span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="op">}</span><span class="pp">                                                                      </span><span class="op">\</span></span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>c<span class="pp"> </span><span class="op">=</span><span class="pp"> </span>tree<span class="op">;</span><span class="pp">                                                              </span><span class="op">\</span></span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>p<span class="pp"> </span><span class="op">=</span><span class="pp"> </span>NULL<span class="op">;</span><span class="pp">                                                              </span><span class="op">\</span></span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>r<span class="pp"> </span><span class="op">=</span><span class="pp"> </span><span class="dv">0</span><span class="op">;</span><span class="pp">                                                                 </span><span class="op">\</span></span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="cf">while</span><span class="pp"> </span><span class="op">(</span>c<span class="pp"> </span><span class="op">!=</span><span class="pp"> </span>nil<span class="op">)</span><span class="pp"> </span><span class="op">{</span><span class="pp">                                                     </span><span class="op">\</span></span>
<span id="cb35-34"><a href="#cb35-34" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="co">/* The node is already in the rbtree, we break. */</span><span class="pp">                 </span><span class="op">\</span></span>
<span id="cb35-35"><a href="#cb35-35" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>r<span class="pp"> </span><span class="op">=</span><span class="pp"> </span>cmp<span class="op">((</span>c<span class="op">),</span><span class="pp"> </span><span class="op">(</span>node<span class="op">));</span><span class="pp">                                              </span><span class="op">\</span></span>
<span id="cb35-36"><a href="#cb35-36" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="cf">if</span><span class="pp"> </span><span class="op">(</span>r<span class="pp"> </span><span class="op">==</span><span class="pp"> </span><span class="dv">0</span><span class="op">)</span><span class="pp"> </span><span class="op">{</span><span class="pp">                                                      </span><span class="op">\</span></span>
<span id="cb35-37"><a href="#cb35-37" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span><span class="cf">break</span><span class="op">;</span><span class="pp">                                                         </span><span class="op">\</span></span>
<span id="cb35-38"><a href="#cb35-38" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="op">}</span><span class="pp">                                                                  </span><span class="op">\</span></span>
<span id="cb35-39"><a href="#cb35-39" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>p<span class="pp"> </span><span class="op">=</span><span class="pp"> </span>c<span class="op">;</span><span class="pp">                                                             </span><span class="op">\</span></span>
<span id="cb35-40"><a href="#cb35-40" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="co">/* Lesser on the left, greater on the right. */</span><span class="pp">                    </span><span class="op">\</span></span>
<span id="cb35-41"><a href="#cb35-41" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>c<span class="pp"> </span><span class="op">=</span><span class="pp"> </span>r<span class="pp"> </span><span class="op">&gt;</span><span class="pp"> </span><span class="dv">0</span><span class="pp"> </span><span class="op">?</span><span class="pp"> </span>left<span class="op">(</span>c<span class="op">)</span><span class="pp"> </span><span class="op">:</span><span class="pp"> </span>right<span class="op">(</span>c<span class="op">);</span><span class="pp">                                    </span><span class="op">\</span></span>
<span id="cb35-42"><a href="#cb35-42" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="op">}</span><span class="pp">                                                                      </span><span class="op">\</span></span>
<span id="cb35-43"><a href="#cb35-43" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="co">/* The node is already in the rbtree, we break. */</span><span class="pp">                     </span><span class="op">\</span></span>
<span id="cb35-44"><a href="#cb35-44" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="cf">if</span><span class="pp"> </span><span class="op">(</span>c<span class="pp"> </span><span class="op">!=</span><span class="pp"> </span>nil<span class="op">)</span><span class="pp"> </span><span class="op">{</span><span class="pp">                                                        </span><span class="op">\</span></span>
<span id="cb35-45"><a href="#cb35-45" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="cf">break</span><span class="op">;</span><span class="pp">                                                             </span><span class="op">\</span></span>
<span id="cb35-46"><a href="#cb35-46" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="op">}</span><span class="pp">                                                                      </span><span class="op">\</span></span>
<span id="cb35-47"><a href="#cb35-47" aria-hidden="true" tabindex="-1"></a><span class="pp">                                                                               </span><span class="op">\</span></span>
<span id="cb35-48"><a href="#cb35-48" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>parent<span class="op">(</span>node<span class="op">)</span><span class="pp"> </span><span class="op">=</span><span class="pp"> </span>p<span class="op">;</span><span class="pp">                                                      </span><span class="op">\</span></span>
<span id="cb35-49"><a href="#cb35-49" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>rb_make_red_m<span class="op">(</span>color<span class="op">(</span>node<span class="op">));</span><span class="pp">                                            </span><span class="op">\</span></span>
<span id="cb35-50"><a href="#cb35-50" aria-hidden="true" tabindex="-1"></a><span class="pp">                                                                               </span><span class="op">\</span></span>
<span id="cb35-51"><a href="#cb35-51" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="cf">if</span><span class="pp"> </span><span class="op">(</span>r<span class="pp"> </span><span class="op">&gt;</span><span class="pp"> </span><span class="dv">0</span><span class="op">)</span><span class="pp"> </span><span class="op">{</span><span class="pp">                                                           </span><span class="op">\</span></span>
<span id="cb35-52"><a href="#cb35-52" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>left<span class="op">(</span>p<span class="op">)</span><span class="pp"> </span><span class="op">=</span><span class="pp"> </span>node<span class="op">;</span><span class="pp">                                                    </span><span class="op">\</span></span>
<span id="cb35-53"><a href="#cb35-53" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="op">}</span><span class="pp"> </span><span class="cf">else</span><span class="pp"> </span><span class="op">{</span><span class="pp">                                                               </span><span class="op">\</span></span>
<span id="cb35-54"><a href="#cb35-54" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>right<span class="op">(</span>p<span class="op">)</span><span class="pp"> </span><span class="op">=</span><span class="pp"> </span>node<span class="op">;</span><span class="pp">                                                   </span><span class="op">\</span></span>
<span id="cb35-55"><a href="#cb35-55" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="op">}</span><span class="pp">                                                                      </span><span class="op">\</span></span>
<span id="cb35-56"><a href="#cb35-56" aria-hidden="true" tabindex="-1"></a><span class="pp">                                                                               </span><span class="op">\</span></span>
<span id="cb35-57"><a href="#cb35-57" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>_rb_insert_fix_m<span class="op">(</span>type<span class="op">,</span><span class="pp"> </span>nil<span class="op">,</span><span class="pp"> </span>color<span class="op">,</span><span class="pp"> </span>parent<span class="op">,</span><span class="pp"> </span>left<span class="op">,</span><span class="pp"> </span>right<span class="op">,</span><span class="pp"> </span>tree<span class="op">,</span><span class="pp"> </span>node<span class="op">);</span><span class="pp">   </span><span class="op">\</span></span>
<span id="cb35-58"><a href="#cb35-58" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="op">}</span><span class="pp"> </span><span class="cf">while</span><span class="pp"> </span><span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb35-59"><a href="#cb35-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-60"><a href="#cb35-60" aria-hidden="true" tabindex="-1"></a><span class="pp">#define rb_insert_m</span><span class="op">(</span>type<span class="op">,</span><span class="pp"> </span>nil<span class="op">,</span><span class="pp"> </span>color<span class="op">,</span><span class="pp"> </span>parent<span class="op">,</span><span class="pp"> </span>left<span class="op">,</span><span class="pp"> </span>right<span class="op">,</span><span class="pp"> </span>cmp<span class="op">,</span><span class="pp"> </span>tree<span class="op">,</span><span class="pp"> </span>node<span class="op">)</span><span class="pp">    </span><span class="op">\</span></span>
<span id="cb35-61"><a href="#cb35-61" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="op">{</span><span class="pp">                                                                          </span><span class="op">\</span></span>
<span id="cb35-62"><a href="#cb35-62" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>type<span class="op">*</span><span class="pp"> </span>__rb_ins_current_<span class="op">;</span><span class="pp">                                               </span><span class="op">\</span></span>
<span id="cb35-63"><a href="#cb35-63" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>type<span class="op">*</span><span class="pp"> </span>__rb_ins_parent_<span class="op">;</span><span class="pp">                                                </span><span class="op">\</span></span>
<span id="cb35-64"><a href="#cb35-64" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="dt">int</span><span class="pp">   </span>__rb_ins_result_<span class="op">;</span><span class="pp">                                                </span><span class="op">\</span></span>
<span id="cb35-65"><a href="#cb35-65" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>_rb_insert_m<span class="op">(</span><span class="pp">                                                          </span><span class="op">\</span></span>
<span id="cb35-66"><a href="#cb35-66" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>type<span class="op">,</span><span class="pp">                                                          </span><span class="op">\</span></span>
<span id="cb35-67"><a href="#cb35-67" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>nil<span class="op">,</span><span class="pp">                                                           </span><span class="op">\</span></span>
<span id="cb35-68"><a href="#cb35-68" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>color<span class="op">,</span><span class="pp">                                                         </span><span class="op">\</span></span>
<span id="cb35-69"><a href="#cb35-69" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>parent<span class="op">,</span><span class="pp">                                                        </span><span class="op">\</span></span>
<span id="cb35-70"><a href="#cb35-70" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>left<span class="op">,</span><span class="pp">                                                          </span><span class="op">\</span></span>
<span id="cb35-71"><a href="#cb35-71" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>right<span class="op">,</span><span class="pp">                                                         </span><span class="op">\</span></span>
<span id="cb35-72"><a href="#cb35-72" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>cmp<span class="op">,</span><span class="pp">                                                           </span><span class="op">\</span></span>
<span id="cb35-73"><a href="#cb35-73" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>tree<span class="op">,</span><span class="pp">                                                          </span><span class="op">\</span></span>
<span id="cb35-74"><a href="#cb35-74" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>node<span class="op">,</span><span class="pp">                                                          </span><span class="op">\</span></span>
<span id="cb35-75"><a href="#cb35-75" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>__rb_ins_current_<span class="op">,</span><span class="pp">                                             </span><span class="op">\</span></span>
<span id="cb35-76"><a href="#cb35-76" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>__rb_ins_parent_<span class="op">,</span><span class="pp">                                              </span><span class="op">\</span></span>
<span id="cb35-77"><a href="#cb35-77" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>__rb_ins_result_<span class="op">)</span><span class="pp">                                              </span><span class="op">\</span></span>
<span id="cb35-78"><a href="#cb35-78" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="op">}</span></span></code></pre></div>
<h2 id="rb_delete_node_m">rb_delete_node_m</h2>
<p>Bound: cx##_delete_node</p>
<p>Delete a node from the tree. This function acts on an actual tree node. If you don't have it; use rb_find_m first or rb_delete_m. The root node (<em>tree</em>) can change.</p>
<dl class="incremental">
<dt>tree</dt>
<dd><p>The root node of the tree. A pointer to nil represents an empty tree.</p>
</dd>
<dt>node</dt>
<dd><p>The node to delete.</p>
</dd>
</dl>
<div class="sourceCode" id="cb36"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#define _rb_delete_node_m</span><span class="op">(</span><span class="pp">                                                     </span><span class="op">\</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>type<span class="op">,</span><span class="pp"> </span>nil<span class="op">,</span><span class="pp"> </span>color<span class="op">,</span><span class="pp"> </span>parent<span class="op">,</span><span class="pp"> </span>left<span class="op">,</span><span class="pp"> </span>right<span class="op">,</span><span class="pp"> </span>tree<span class="op">,</span><span class="pp"> </span>node<span class="op">,</span><span class="pp"> </span>x<span class="op">,</span><span class="pp"> </span>y<span class="op">)</span><span class="pp">               </span><span class="op">\</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="op">{</span><span class="pp">                                                                          </span><span class="op">\</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="ot">assert</span><span class="op">(</span>tree<span class="pp"> </span><span class="op">!=</span><span class="pp"> </span>NULL<span class="pp"> </span><span class="op">&amp;&amp;</span><span class="pp"> </span><span class="st">&quot;Tree was not initialized&quot;</span><span class="op">);</span><span class="pp">                    </span><span class="op">\</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="ot">assert</span><span class="op">(</span>tree<span class="pp"> </span><span class="op">!=</span><span class="pp"> </span>nil<span class="pp"> </span><span class="op">&amp;&amp;</span><span class="pp"> </span><span class="st">&quot;Cannot remove node from empty tree&quot;</span><span class="op">);</span><span class="pp">           </span><span class="op">\</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="ot">assert</span><span class="op">(</span>node<span class="pp"> </span><span class="op">!=</span><span class="pp"> </span>nil<span class="pp"> </span><span class="op">&amp;&amp;</span><span class="pp"> </span><span class="st">&quot;Cannot delete nil node&quot;</span><span class="op">);</span><span class="pp">                       </span><span class="op">\</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="ot">assert</span><span class="op">((</span>parent<span class="op">(</span>node<span class="op">)</span><span class="pp"> </span><span class="op">!=</span><span class="pp"> </span>nil<span class="pp"> </span><span class="op">||</span><span class="pp"> </span>left<span class="op">(</span>node<span class="op">)</span><span class="pp"> </span><span class="op">!=</span><span class="pp"> </span>nil<span class="pp"> </span><span class="op">||</span><span class="pp">                    </span><span class="op">\</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>right<span class="op">(</span>node<span class="op">)</span><span class="pp"> </span><span class="op">!=</span><span class="pp"> </span>nil<span class="pp"> </span><span class="op">||</span><span class="pp"> </span>rb_is_black_m<span class="op">(</span>color<span class="op">(</span>node<span class="op">)))</span><span class="pp"> </span><span class="op">&amp;&amp;</span><span class="pp">           </span><span class="op">\</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a><span class="pp">               </span><span class="st">&quot;Node is not in a tree&quot;</span><span class="op">);</span><span class="pp">                                       </span><span class="op">\</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="cf">if</span><span class="pp"> </span><span class="op">(</span>left<span class="op">(</span>node<span class="op">)</span><span class="pp"> </span><span class="op">==</span><span class="pp"> </span>nil<span class="pp"> </span><span class="op">||</span><span class="pp"> </span>right<span class="op">(</span>node<span class="op">)</span><span class="pp"> </span><span class="op">==</span><span class="pp"> </span>nil<span class="op">)</span><span class="pp"> </span><span class="op">{</span><span class="pp">                         </span><span class="op">\</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="co">/* This node has at least one nil node, delete is simple. */</span><span class="pp">       </span><span class="op">\</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>y<span class="pp"> </span><span class="op">=</span><span class="pp"> </span>node<span class="op">;</span><span class="pp">                                                          </span><span class="op">\</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="op">}</span><span class="pp"> </span><span class="cf">else</span><span class="pp"> </span><span class="op">{</span><span class="pp">                                                               </span><span class="op">\</span></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="co">/* We need to find another node for deletion that has only one     \</span></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a><span class="co">             * child. This is tree-next. */</span><span class="pp">                                                         </span><span class="op">\</span></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>y<span class="pp"> </span><span class="op">=</span><span class="pp"> </span>right<span class="op">(</span>node<span class="op">);</span><span class="pp">                                                   </span><span class="op">\</span></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="cf">while</span><span class="pp"> </span><span class="op">(</span>left<span class="op">(</span>y<span class="op">)</span><span class="pp"> </span><span class="op">!=</span><span class="pp"> </span>nil<span class="op">)</span><span class="pp"> </span><span class="op">{</span><span class="pp">                                           </span><span class="op">\</span></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>y<span class="pp"> </span><span class="op">=</span><span class="pp"> </span>left<span class="op">(</span>y<span class="op">);</span><span class="pp">                                                   </span><span class="op">\</span></span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="op">}</span><span class="pp">                                                                  </span><span class="op">\</span></span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="op">}</span><span class="pp">                                                                      </span><span class="op">\</span></span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a><span class="pp">                                                                               </span><span class="op">\</span></span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="co">/* If y has a child we have to attach it to the parent. */</span><span class="pp">             </span><span class="op">\</span></span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="cf">if</span><span class="pp"> </span><span class="op">(</span>left<span class="op">(</span>y<span class="op">)</span><span class="pp"> </span><span class="op">!=</span><span class="pp"> </span>nil<span class="op">)</span><span class="pp"> </span><span class="op">{</span><span class="pp">                                                  </span><span class="op">\</span></span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>x<span class="pp"> </span><span class="op">=</span><span class="pp"> </span>left<span class="op">(</span>y<span class="op">);</span><span class="pp">                                                       </span><span class="op">\</span></span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="op">}</span><span class="pp"> </span><span class="cf">else</span><span class="pp"> </span><span class="op">{</span><span class="pp">                                                               </span><span class="op">\</span></span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>x<span class="pp"> </span><span class="op">=</span><span class="pp"> </span>right<span class="op">(</span>y<span class="op">);</span><span class="pp">                                                      </span><span class="op">\</span></span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="op">}</span><span class="pp">                                                                      </span><span class="op">\</span></span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a><span class="pp">                                                                               </span><span class="op">\</span></span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="co">/* Remove y from the tree. */</span><span class="pp">                                          </span><span class="op">\</span></span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>parent<span class="op">(</span>x<span class="op">)</span><span class="pp"> </span><span class="op">=</span><span class="pp"> </span>parent<span class="op">(</span>y<span class="op">);</span><span class="pp">                                                 </span><span class="op">\</span></span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="cf">if</span><span class="pp"> </span><span class="op">(</span>parent<span class="op">(</span>y<span class="op">)</span><span class="pp"> </span><span class="op">!=</span><span class="pp"> </span>nil<span class="op">)</span><span class="pp"> </span><span class="op">{</span><span class="pp">                                                </span><span class="op">\</span></span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="cf">if</span><span class="pp"> </span><span class="op">(</span>y<span class="pp"> </span><span class="op">==</span><span class="pp"> </span>left<span class="op">(</span>parent<span class="op">(</span>y<span class="op">)))</span><span class="pp"> </span><span class="op">{</span><span class="pp">                                        </span><span class="op">\</span></span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>left<span class="op">(</span>parent<span class="op">(</span>y<span class="op">))</span><span class="pp"> </span><span class="op">=</span><span class="pp"> </span>x<span class="op">;</span><span class="pp">                                           </span><span class="op">\</span></span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="op">}</span><span class="pp"> </span><span class="cf">else</span><span class="pp"> </span><span class="op">{</span><span class="pp">                                                           </span><span class="op">\</span></span>
<span id="cb36-35"><a href="#cb36-35" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>right<span class="op">(</span>parent<span class="op">(</span>y<span class="op">))</span><span class="pp"> </span><span class="op">=</span><span class="pp"> </span>x<span class="op">;</span><span class="pp">                                          </span><span class="op">\</span></span>
<span id="cb36-36"><a href="#cb36-36" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="op">}</span><span class="pp">                                                                  </span><span class="op">\</span></span>
<span id="cb36-37"><a href="#cb36-37" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="op">}</span><span class="pp"> </span><span class="cf">else</span><span class="pp"> </span><span class="op">{</span><span class="pp">                                                               </span><span class="op">\</span></span>
<span id="cb36-38"><a href="#cb36-38" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>tree<span class="pp"> </span><span class="op">=</span><span class="pp"> </span>x<span class="op">;</span><span class="pp">                                                          </span><span class="op">\</span></span>
<span id="cb36-39"><a href="#cb36-39" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="op">}</span><span class="pp">                                                                      </span><span class="op">\</span></span>
<span id="cb36-40"><a href="#cb36-40" aria-hidden="true" tabindex="-1"></a><span class="pp">                                                                               </span><span class="op">\</span></span>
<span id="cb36-41"><a href="#cb36-41" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="co">/* A black node was removed, to fix the problem we pretend to have     \</span></span>
<span id="cb36-42"><a href="#cb36-42" aria-hidden="true" tabindex="-1"></a><span class="co">         * pushed the blackness onto x. Therefore x is double black and                             \</span></span>
<span id="cb36-43"><a href="#cb36-43" aria-hidden="true" tabindex="-1"></a><span class="co">         * violates property 1. */</span><span class="pp">                                             </span><span class="op">\</span></span>
<span id="cb36-44"><a href="#cb36-44" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="cf">if</span><span class="pp"> </span><span class="op">(</span>rb_is_black_m<span class="op">(</span>color<span class="op">(</span>y<span class="op">)))</span><span class="pp"> </span><span class="op">{</span><span class="pp">                                         </span><span class="op">\</span></span>
<span id="cb36-45"><a href="#cb36-45" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>_rb_delete_fix_m<span class="op">(</span>type<span class="op">,</span><span class="pp"> </span>nil<span class="op">,</span><span class="pp"> </span>color<span class="op">,</span><span class="pp"> </span>parent<span class="op">,</span><span class="pp"> </span>left<span class="op">,</span><span class="pp"> </span>right<span class="op">,</span><span class="pp"> </span>tree<span class="op">,</span><span class="pp"> </span>x<span class="op">);</span><span class="pp">  </span><span class="op">\</span></span>
<span id="cb36-46"><a href="#cb36-46" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="op">}</span><span class="pp">                                                                      </span><span class="op">\</span></span>
<span id="cb36-47"><a href="#cb36-47" aria-hidden="true" tabindex="-1"></a><span class="pp">                                                                               </span><span class="op">\</span></span>
<span id="cb36-48"><a href="#cb36-48" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="co">/* Replace y with the node since we don&#39;t control memory. */</span><span class="pp">           </span><span class="op">\</span></span>
<span id="cb36-49"><a href="#cb36-49" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="cf">if</span><span class="pp"> </span><span class="op">(</span>node<span class="pp"> </span><span class="op">!=</span><span class="pp"> </span>y<span class="op">)</span><span class="pp"> </span><span class="op">{</span><span class="pp">                                                       </span><span class="op">\</span></span>
<span id="cb36-50"><a href="#cb36-50" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="cf">if</span><span class="pp"> </span><span class="op">(</span>parent<span class="op">(</span>node<span class="op">)</span><span class="pp"> </span><span class="op">==</span><span class="pp"> </span>nil<span class="op">)</span><span class="pp"> </span><span class="op">{</span><span class="pp">                                         </span><span class="op">\</span></span>
<span id="cb36-51"><a href="#cb36-51" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>tree<span class="pp">      </span><span class="op">=</span><span class="pp"> </span>y<span class="op">;</span><span class="pp">                                                 </span><span class="op">\</span></span>
<span id="cb36-52"><a href="#cb36-52" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>parent<span class="op">(</span>y<span class="op">)</span><span class="pp"> </span><span class="op">=</span><span class="pp"> </span>nil<span class="op">;</span><span class="pp">                                               </span><span class="op">\</span></span>
<span id="cb36-53"><a href="#cb36-53" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="op">}</span><span class="pp"> </span><span class="cf">else</span><span class="pp"> </span><span class="op">{</span><span class="pp">                                                           </span><span class="op">\</span></span>
<span id="cb36-54"><a href="#cb36-54" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span><span class="cf">if</span><span class="pp"> </span><span class="op">(</span>node<span class="pp"> </span><span class="op">==</span><span class="pp"> </span>left<span class="op">(</span>parent<span class="op">(</span>node<span class="op">)))</span><span class="pp"> </span><span class="op">{</span><span class="pp">                              </span><span class="op">\</span></span>
<span id="cb36-55"><a href="#cb36-55" aria-hidden="true" tabindex="-1"></a><span class="pp">                    </span>left<span class="op">(</span>parent<span class="op">(</span>node<span class="op">))</span><span class="pp"> </span><span class="op">=</span><span class="pp"> </span>y<span class="op">;</span><span class="pp">                                    </span><span class="op">\</span></span>
<span id="cb36-56"><a href="#cb36-56" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span><span class="op">}</span><span class="pp"> </span><span class="cf">else</span><span class="pp"> </span><span class="cf">if</span><span class="pp"> </span><span class="op">(</span>node<span class="pp"> </span><span class="op">==</span><span class="pp"> </span>right<span class="op">(</span>parent<span class="op">(</span>node<span class="op">)))</span><span class="pp"> </span><span class="op">{</span><span class="pp">                      </span><span class="op">\</span></span>
<span id="cb36-57"><a href="#cb36-57" aria-hidden="true" tabindex="-1"></a><span class="pp">                    </span>right<span class="op">(</span>parent<span class="op">(</span>node<span class="op">))</span><span class="pp"> </span><span class="op">=</span><span class="pp"> </span>y<span class="op">;</span><span class="pp">                                   </span><span class="op">\</span></span>
<span id="cb36-58"><a href="#cb36-58" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span><span class="op">}</span><span class="pp">                                                              </span><span class="op">\</span></span>
<span id="cb36-59"><a href="#cb36-59" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="op">}</span><span class="pp">                                                                  </span><span class="op">\</span></span>
<span id="cb36-60"><a href="#cb36-60" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="cf">if</span><span class="pp"> </span><span class="op">(</span>left<span class="op">(</span>node<span class="op">)</span><span class="pp"> </span><span class="op">!=</span><span class="pp"> </span>nil<span class="op">)</span><span class="pp"> </span><span class="op">{</span><span class="pp">                                           </span><span class="op">\</span></span>
<span id="cb36-61"><a href="#cb36-61" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>parent<span class="op">(</span>left<span class="op">(</span>node<span class="op">))</span><span class="pp"> </span><span class="op">=</span><span class="pp"> </span>y<span class="op">;</span><span class="pp">                                        </span><span class="op">\</span></span>
<span id="cb36-62"><a href="#cb36-62" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="op">}</span><span class="pp">                                                                  </span><span class="op">\</span></span>
<span id="cb36-63"><a href="#cb36-63" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="cf">if</span><span class="pp"> </span><span class="op">(</span>right<span class="op">(</span>node<span class="op">)</span><span class="pp"> </span><span class="op">!=</span><span class="pp"> </span>nil<span class="op">)</span><span class="pp"> </span><span class="op">{</span><span class="pp">                                          </span><span class="op">\</span></span>
<span id="cb36-64"><a href="#cb36-64" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>parent<span class="op">(</span>right<span class="op">(</span>node<span class="op">))</span><span class="pp"> </span><span class="op">=</span><span class="pp"> </span>y<span class="op">;</span><span class="pp">                                       </span><span class="op">\</span></span>
<span id="cb36-65"><a href="#cb36-65" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="op">}</span><span class="pp">                                                                  </span><span class="op">\</span></span>
<span id="cb36-66"><a href="#cb36-66" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>parent<span class="op">(</span>y<span class="op">)</span><span class="pp"> </span><span class="op">=</span><span class="pp"> </span>parent<span class="op">(</span>node<span class="op">);</span><span class="pp">                                          </span><span class="op">\</span></span>
<span id="cb36-67"><a href="#cb36-67" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>left<span class="op">(</span>y<span class="op">)</span><span class="pp">   </span><span class="op">=</span><span class="pp"> </span>left<span class="op">(</span>node<span class="op">);</span><span class="pp">                                            </span><span class="op">\</span></span>
<span id="cb36-68"><a href="#cb36-68" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>right<span class="op">(</span>y<span class="op">)</span><span class="pp">  </span><span class="op">=</span><span class="pp"> </span>right<span class="op">(</span>node<span class="op">);</span><span class="pp">                                           </span><span class="op">\</span></span>
<span id="cb36-69"><a href="#cb36-69" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>color<span class="op">(</span>y<span class="op">)</span><span class="pp">  </span><span class="op">=</span><span class="pp"> </span>color<span class="op">(</span>node<span class="op">);</span><span class="pp">                                           </span><span class="op">\</span></span>
<span id="cb36-70"><a href="#cb36-70" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="op">}</span><span class="pp">                                                                      </span><span class="op">\</span></span>
<span id="cb36-71"><a href="#cb36-71" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="co">/* Clear the node. */</span><span class="pp">                                                  </span><span class="op">\</span></span>
<span id="cb36-72"><a href="#cb36-72" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>parent<span class="op">(</span>node<span class="op">)</span><span class="pp"> </span><span class="op">=</span><span class="pp"> </span>nil<span class="op">;</span><span class="pp">                                                    </span><span class="op">\</span></span>
<span id="cb36-73"><a href="#cb36-73" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>left<span class="op">(</span>node<span class="op">)</span><span class="pp">   </span><span class="op">=</span><span class="pp"> </span>nil<span class="op">;</span><span class="pp">                                                    </span><span class="op">\</span></span>
<span id="cb36-74"><a href="#cb36-74" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>right<span class="op">(</span>node<span class="op">)</span><span class="pp">  </span><span class="op">=</span><span class="pp"> </span>nil<span class="op">;</span><span class="pp">                                                    </span><span class="op">\</span></span>
<span id="cb36-75"><a href="#cb36-75" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>color<span class="op">(</span>node<span class="op">)</span><span class="pp">  </span><span class="op">=</span><span class="pp"> </span>RB_BLACK<span class="op">;</span><span class="pp">                                               </span><span class="op">\</span></span>
<span id="cb36-76"><a href="#cb36-76" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="op">}</span></span>
<span id="cb36-77"><a href="#cb36-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-78"><a href="#cb36-78" aria-hidden="true" tabindex="-1"></a><span class="pp">#define rb_delete_node_m</span><span class="op">(</span>type<span class="op">,</span><span class="pp"> </span>nil<span class="op">,</span><span class="pp"> </span>color<span class="op">,</span><span class="pp"> </span>parent<span class="op">,</span><span class="pp"> </span>left<span class="op">,</span><span class="pp"> </span>right<span class="op">,</span><span class="pp"> </span>tree<span class="op">,</span><span class="pp"> </span>node<span class="op">)</span><span class="pp">    </span><span class="op">\</span></span>
<span id="cb36-79"><a href="#cb36-79" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="op">{</span><span class="pp">                                                                          </span><span class="op">\</span></span>
<span id="cb36-80"><a href="#cb36-80" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>type<span class="op">*</span><span class="pp"> </span>__rb_del_x_<span class="op">;</span><span class="pp">                                                     </span><span class="op">\</span></span>
<span id="cb36-81"><a href="#cb36-81" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>type<span class="op">*</span><span class="pp"> </span>__rb_del_y_<span class="op">;</span><span class="pp">                                                     </span><span class="op">\</span></span>
<span id="cb36-82"><a href="#cb36-82" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>_rb_delete_node_m<span class="op">(</span><span class="pp">                                                     </span><span class="op">\</span></span>
<span id="cb36-83"><a href="#cb36-83" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>type<span class="op">,</span><span class="pp">                                                          </span><span class="op">\</span></span>
<span id="cb36-84"><a href="#cb36-84" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>nil<span class="op">,</span><span class="pp">                                                           </span><span class="op">\</span></span>
<span id="cb36-85"><a href="#cb36-85" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>color<span class="op">,</span><span class="pp">                                                         </span><span class="op">\</span></span>
<span id="cb36-86"><a href="#cb36-86" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>parent<span class="op">,</span><span class="pp">                                                        </span><span class="op">\</span></span>
<span id="cb36-87"><a href="#cb36-87" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>left<span class="op">,</span><span class="pp">                                                          </span><span class="op">\</span></span>
<span id="cb36-88"><a href="#cb36-88" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>right<span class="op">,</span><span class="pp">                                                         </span><span class="op">\</span></span>
<span id="cb36-89"><a href="#cb36-89" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>tree<span class="op">,</span><span class="pp">                                                          </span><span class="op">\</span></span>
<span id="cb36-90"><a href="#cb36-90" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>node<span class="op">,</span><span class="pp">                                                          </span><span class="op">\</span></span>
<span id="cb36-91"><a href="#cb36-91" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>__rb_del_x_<span class="op">,</span><span class="pp">                                                   </span><span class="op">\</span></span>
<span id="cb36-92"><a href="#cb36-92" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>__rb_del_y_<span class="op">)</span><span class="pp">                                                   </span><span class="op">\</span></span>
<span id="cb36-93"><a href="#cb36-93" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="op">}</span></span></code></pre></div>
<h2 id="rb_find_m">rb_find_m</h2>
<p>Bound: cx##_find</p>
<p>Find a node using another node as key. The node will be set to nil if the key was not found.</p>
<p>The bound function will return 0 on success.</p>
<dl class="incremental">
<dt>cmp</dt>
<dd><p>Comparator (rb_pointer_cmp_m or rb_safe_value_cmp_m could be used).</p>
</dd>
<dt>tree</dt>
<dd><p>The root node of the tree. A pointer to nil represents an empty tree.</p>
</dd>
<dt>key</dt>
<dd><p>The node used as search key.</p>
</dd>
<dt>node</dt>
<dd><p>The output node.</p>
</dd>
</dl>
<div class="sourceCode" id="cb37"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#define rb_find_m</span><span class="op">(</span>type<span class="op">,</span><span class="pp"> </span>nil<span class="op">,</span><span class="pp"> </span>color<span class="op">,</span><span class="pp"> </span>parent<span class="op">,</span><span class="pp"> </span>left<span class="op">,</span><span class="pp"> </span>right<span class="op">,</span><span class="pp"> </span>cmp<span class="op">,</span><span class="pp"> </span>tree<span class="op">,</span><span class="pp"> </span>key<span class="op">,</span><span class="pp"> </span>node<span class="op">)</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="op">{</span><span class="pp">                                                                          </span><span class="op">\</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="ot">assert</span><span class="op">(</span>tree<span class="pp"> </span><span class="op">!=</span><span class="pp"> </span>NULL<span class="pp"> </span><span class="op">&amp;&amp;</span><span class="pp"> </span><span class="st">&quot;Tree was not initialized&quot;</span><span class="op">);</span><span class="pp">                    </span><span class="op">\</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="ot">assert</span><span class="op">(</span>key<span class="pp"> </span><span class="op">!=</span><span class="pp"> </span>nil<span class="pp"> </span><span class="op">&amp;&amp;</span><span class="pp"> </span><span class="st">&quot;Do not use nil as search key&quot;</span><span class="op">);</span><span class="pp">                  </span><span class="op">\</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="cf">if</span><span class="pp"> </span><span class="op">(</span>tree<span class="pp"> </span><span class="op">==</span><span class="pp"> </span>nil<span class="op">)</span><span class="pp"> </span><span class="op">{</span><span class="pp">                                                     </span><span class="op">\</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>node<span class="pp"> </span><span class="op">=</span><span class="pp"> </span>nil<span class="op">;</span><span class="pp">                                                        </span><span class="op">\</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="op">}</span><span class="pp"> </span><span class="cf">else</span><span class="pp"> </span><span class="op">{</span><span class="pp">                                                               </span><span class="op">\</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>node<span class="pp">                  </span><span class="op">=</span><span class="pp"> </span>tree<span class="op">;</span><span class="pp">                                      </span><span class="op">\</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="dt">int</span><span class="pp"> </span>__rb_find_result_<span class="pp"> </span><span class="op">=</span><span class="pp"> </span><span class="dv">1</span><span class="op">;</span><span class="pp">                                         </span><span class="op">\</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="cf">while</span><span class="pp"> </span><span class="op">(</span>__rb_find_result_<span class="pp"> </span><span class="op">&amp;&amp;</span><span class="pp"> </span>node<span class="pp"> </span><span class="op">!=</span><span class="pp"> </span>nil<span class="op">)</span><span class="pp"> </span><span class="op">{</span><span class="pp">                         </span><span class="op">\</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>__rb_find_result_<span class="pp"> </span><span class="op">=</span><span class="pp"> </span>cmp<span class="op">((</span>node<span class="op">),</span><span class="pp"> </span><span class="op">(</span>key<span class="op">));</span><span class="pp">                        </span><span class="op">\</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span><span class="cf">if</span><span class="pp"> </span><span class="op">(</span>__rb_find_result_<span class="pp"> </span><span class="op">==</span><span class="pp"> </span><span class="dv">0</span><span class="op">)</span><span class="pp"> </span><span class="op">{</span><span class="pp">                                  </span><span class="op">\</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a><span class="pp">                    </span><span class="cf">break</span><span class="op">;</span><span class="pp">                                                     </span><span class="op">\</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span><span class="op">}</span><span class="pp">                                                              </span><span class="op">\</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>node<span class="pp"> </span><span class="op">=</span><span class="pp"> </span>__rb_find_result_<span class="pp"> </span><span class="op">&gt;</span><span class="pp"> </span><span class="dv">0</span><span class="pp"> </span><span class="op">?</span><span class="pp"> </span>left<span class="op">(</span>node<span class="op">)</span><span class="pp"> </span><span class="op">:</span><span class="pp"> </span>right<span class="op">(</span>node<span class="op">);</span><span class="pp">       </span><span class="op">\</span></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="op">}</span><span class="pp">                                                                  </span><span class="op">\</span></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="op">}</span><span class="pp">                                                                      </span><span class="op">\</span></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="op">}</span></span></code></pre></div>
<h2 id="rb_replace_node_m">rb_replace_node_m</h2>
<p>Bound: cx##_replace_node</p>
<p>Replace a node with another. The cmp(old, new) has to return 0 or the function won't do anything.</p>
<p>The bound function will return 0 on success.</p>
<dl class="incremental">
<dt>cmp</dt>
<dd><p>Comparator (rb_pointer_cmp_m or rb_safe_value_cmp_m could be used).</p>
</dd>
<dt>tree</dt>
<dd><p>The root node of the tree. A pointer to nil represents an empty tree.</p>
</dd>
<dt>old</dt>
<dd><p>The node to be replaced.</p>
</dd>
<dt>new</dt>
<dd><p>The new node. Has not to be initialized since all fields are replaced.</p>
</dd>
</dl>
<div class="sourceCode" id="cb38"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#define rb_replace_node_m</span><span class="op">(</span><span class="pp">                                                     </span><span class="op">\</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>type<span class="op">,</span><span class="pp"> </span>nil<span class="op">,</span><span class="pp"> </span>color<span class="op">,</span><span class="pp"> </span>parent<span class="op">,</span><span class="pp"> </span>left<span class="op">,</span><span class="pp"> </span>right<span class="op">,</span><span class="pp"> </span>cmp<span class="op">,</span><span class="pp"> </span>tree<span class="op">,</span><span class="pp"> </span>old<span class="op">,</span><span class="pp"> </span><span class="kw">new</span><span class="op">)</span><span class="pp">            </span><span class="op">\</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="op">{</span><span class="pp">                                                                          </span><span class="op">\</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="ot">assert</span><span class="op">(</span>tree<span class="pp"> </span><span class="op">!=</span><span class="pp"> </span>NULL<span class="pp"> </span><span class="op">&amp;&amp;</span><span class="pp"> </span><span class="st">&quot;Tree was not initialized&quot;</span><span class="op">);</span><span class="pp">                    </span><span class="op">\</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="ot">assert</span><span class="op">(</span>tree<span class="pp"> </span><span class="op">!=</span><span class="pp"> </span>nil<span class="pp"> </span><span class="op">&amp;&amp;</span><span class="pp"> </span><span class="st">&quot;The tree can&#39;t be nil&quot;</span><span class="op">);</span><span class="pp">                        </span><span class="op">\</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="ot">assert</span><span class="op">(</span>old<span class="pp"> </span><span class="op">!=</span><span class="pp"> </span>nil<span class="pp"> </span><span class="op">&amp;&amp;</span><span class="pp"> </span><span class="st">&quot;The old node can&#39;t be nil&quot;</span><span class="op">);</span><span class="pp">                     </span><span class="op">\</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="ot">assert</span><span class="op">(</span><span class="kw">new</span><span class="pp"> </span><span class="op">!=</span><span class="pp"> </span>nil<span class="pp"> </span><span class="op">&amp;&amp;</span><span class="pp"> </span><span class="st">&quot;The new node can&#39;t be nil&quot;</span><span class="op">);</span><span class="pp">                     </span><span class="op">\</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="ot">assert</span><span class="op">(</span><span class="kw">new</span><span class="pp"> </span><span class="op">!=</span><span class="pp"> </span>old<span class="pp"> </span><span class="op">&amp;&amp;</span><span class="pp"> </span><span class="st">&quot;The old and new node must differ&quot;</span><span class="op">);</span><span class="pp">              </span><span class="op">\</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="cf">if</span><span class="pp"> </span><span class="op">(</span>cmp<span class="op">((</span>old<span class="op">),</span><span class="pp"> </span><span class="op">(</span><span class="kw">new</span><span class="op">))</span><span class="pp"> </span><span class="op">==</span><span class="pp"> </span><span class="dv">0</span><span class="op">)</span><span class="pp"> </span><span class="op">{</span><span class="pp">                                          </span><span class="op">\</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="cf">if</span><span class="pp"> </span><span class="op">(</span>old<span class="pp"> </span><span class="op">==</span><span class="pp"> </span>tree<span class="op">)</span><span class="pp"> </span><span class="op">{</span><span class="pp">                                                 </span><span class="op">\</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>tree<span class="pp"> </span><span class="op">=</span><span class="pp"> </span><span class="kw">new</span><span class="op">;</span><span class="pp">                                                    </span><span class="op">\</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="op">}</span><span class="pp"> </span><span class="cf">else</span><span class="pp"> </span><span class="op">{</span><span class="pp">                                                           </span><span class="op">\</span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span><span class="cf">if</span><span class="pp"> </span><span class="op">(</span>old<span class="pp"> </span><span class="op">==</span><span class="pp"> </span>left<span class="op">(</span>parent<span class="op">(</span>old<span class="op">)))</span><span class="pp"> </span><span class="op">{</span><span class="pp">                                </span><span class="op">\</span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a><span class="pp">                    </span>left<span class="op">(</span>parent<span class="op">(</span>old<span class="op">))</span><span class="pp"> </span><span class="op">=</span><span class="pp"> </span><span class="kw">new</span><span class="op">;</span><span class="pp">                                   </span><span class="op">\</span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span><span class="op">}</span><span class="pp"> </span><span class="cf">else</span><span class="pp"> </span><span class="op">{</span><span class="pp">                                                       </span><span class="op">\</span></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a><span class="pp">                    </span>right<span class="op">(</span>parent<span class="op">(</span>old<span class="op">))</span><span class="pp"> </span><span class="op">=</span><span class="pp"> </span><span class="kw">new</span><span class="op">;</span><span class="pp">                                  </span><span class="op">\</span></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span><span class="op">}</span><span class="pp">                                                              </span><span class="op">\</span></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="op">}</span><span class="pp">                                                                  </span><span class="op">\</span></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="cf">if</span><span class="pp"> </span><span class="op">(</span>left<span class="op">(</span>old<span class="op">)</span><span class="pp"> </span><span class="op">!=</span><span class="pp"> </span>nil<span class="op">)</span><span class="pp"> </span><span class="op">{</span><span class="pp">                                            </span><span class="op">\</span></span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>parent<span class="op">(</span>left<span class="op">(</span>old<span class="op">))</span><span class="pp"> </span><span class="op">=</span><span class="pp"> </span><span class="kw">new</span><span class="op">;</span><span class="pp">                                       </span><span class="op">\</span></span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="op">}</span><span class="pp">                                                                  </span><span class="op">\</span></span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="cf">if</span><span class="pp"> </span><span class="op">(</span>right<span class="op">(</span>old<span class="op">)</span><span class="pp"> </span><span class="op">!=</span><span class="pp"> </span>nil<span class="op">)</span><span class="pp"> </span><span class="op">{</span><span class="pp">                                           </span><span class="op">\</span></span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>parent<span class="op">(</span>right<span class="op">(</span>old<span class="op">))</span><span class="pp"> </span><span class="op">=</span><span class="pp"> </span><span class="kw">new</span><span class="op">;</span><span class="pp">                                      </span><span class="op">\</span></span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="op">}</span><span class="pp">                                                                  </span><span class="op">\</span></span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>parent<span class="op">(</span><span class="kw">new</span><span class="op">)</span><span class="pp"> </span><span class="op">=</span><span class="pp"> </span>parent<span class="op">(</span>old<span class="op">);</span><span class="pp">                                         </span><span class="op">\</span></span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>left<span class="op">(</span><span class="kw">new</span><span class="op">)</span><span class="pp">   </span><span class="op">=</span><span class="pp"> </span>left<span class="op">(</span>old<span class="op">);</span><span class="pp">                                           </span><span class="op">\</span></span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>right<span class="op">(</span><span class="kw">new</span><span class="op">)</span><span class="pp">  </span><span class="op">=</span><span class="pp"> </span>right<span class="op">(</span>old<span class="op">);</span><span class="pp">                                          </span><span class="op">\</span></span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>color<span class="op">(</span><span class="kw">new</span><span class="op">)</span><span class="pp">  </span><span class="op">=</span><span class="pp"> </span>color<span class="op">(</span>old<span class="op">);</span><span class="pp">                                          </span><span class="op">\</span></span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="co">/* Clear the old node. */</span><span class="pp">                                          </span><span class="op">\</span></span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>parent<span class="op">(</span>old<span class="op">)</span><span class="pp"> </span><span class="op">=</span><span class="pp"> </span>nil<span class="op">;</span><span class="pp">                                                 </span><span class="op">\</span></span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>left<span class="op">(</span>old<span class="op">)</span><span class="pp">   </span><span class="op">=</span><span class="pp"> </span>nil<span class="op">;</span><span class="pp">                                                 </span><span class="op">\</span></span>
<span id="cb38-32"><a href="#cb38-32" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>right<span class="op">(</span>old<span class="op">)</span><span class="pp">  </span><span class="op">=</span><span class="pp"> </span>nil<span class="op">;</span><span class="pp">                                                 </span><span class="op">\</span></span>
<span id="cb38-33"><a href="#cb38-33" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>color<span class="op">(</span>old<span class="op">)</span><span class="pp">  </span><span class="op">=</span><span class="pp"> </span>RB_BLACK<span class="op">;</span><span class="pp">                                            </span><span class="op">\</span></span>
<span id="cb38-34"><a href="#cb38-34" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="op">}</span><span class="pp">                                                                      </span><span class="op">\</span></span>
<span id="cb38-35"><a href="#cb38-35" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="op">}</span></span></code></pre></div>
<h2 id="rb_bind_decl_m">rb_bind_decl_m</h2>
<p>Bind rbtree functions to a context. This only generates declarations.</p>
<p>rb_bind_decl_cx_m is just an alias for consistency.</p>
<dl class="incremental">
<dt>cx</dt>
<dd><p>Name of the new context.</p>
</dd>
<dt>type</dt>
<dd><p>The type of the nodes in the red-black tree.</p>
</dd>
</dl>
<div class="sourceCode" id="cb39"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#define rb_bind_decl_cx_m</span><span class="op">(</span>cx<span class="op">,</span><span class="pp"> </span>type<span class="op">)</span><span class="pp">                                            </span><span class="op">\</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span>rb_new_context_m<span class="op">(</span>cx<span class="op">,</span><span class="pp"> </span>type<span class="op">)</span><span class="pp"> </span><span class="dt">void</span><span class="pp"> </span>cx<span class="pp">##</span>_tree_init<span class="op">(</span>type<span class="op">**</span><span class="pp"> </span>tree<span class="op">);</span><span class="pp">               </span><span class="op">\</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="dt">void</span><span class="pp"> </span>cx<span class="pp">##</span>_iter_init<span class="op">(</span>type<span class="op">*</span><span class="pp"> </span>tree<span class="op">,</span><span class="pp"> </span>cx<span class="pp">##</span>_iter_t<span class="op">**</span><span class="pp"> </span>iter<span class="op">,</span><span class="pp"> </span>type<span class="op">**</span><span class="pp"> </span>elem<span class="op">);</span><span class="pp">          </span><span class="op">\</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="dt">void</span><span class="pp"> </span>cx<span class="pp">##</span>_iter_next<span class="op">(</span>cx<span class="pp">##</span>_iter_t<span class="op">*</span><span class="pp"> </span>iter<span class="op">,</span><span class="pp"> </span>type<span class="op">**</span><span class="pp"> </span>elem<span class="op">);</span><span class="pp">                       </span><span class="op">\</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="dt">void</span><span class="pp"> </span>cx<span class="pp">##</span>_node_init<span class="op">(</span>type<span class="op">*</span><span class="pp"> </span>node<span class="op">);</span><span class="pp">                                           </span><span class="op">\</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="dt">int</span><span class="pp">  </span>cx<span class="pp">##</span>_insert<span class="op">(</span>type<span class="op">**</span><span class="pp"> </span>tree<span class="op">,</span><span class="pp"> </span>type<span class="op">*</span><span class="pp"> </span>node<span class="op">);</span><span class="pp">                                 </span><span class="op">\</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="dt">void</span><span class="pp"> </span>cx<span class="pp">##</span>_delete_node<span class="op">(</span>type<span class="op">**</span><span class="pp"> </span>tree<span class="op">,</span><span class="pp"> </span>type<span class="op">*</span><span class="pp"> </span>node<span class="op">);</span><span class="pp">                            </span><span class="op">\</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="dt">int</span><span class="pp">  </span>cx<span class="pp">##</span>_delete<span class="op">(</span>type<span class="op">**</span><span class="pp"> </span>tree<span class="op">,</span><span class="pp"> </span>type<span class="op">*</span><span class="pp"> </span>key<span class="op">,</span><span class="pp"> </span>type<span class="op">**</span><span class="pp"> </span>node<span class="op">);</span><span class="pp">                     </span><span class="op">\</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="dt">int</span><span class="pp">  </span>cx<span class="pp">##</span>_replace_node<span class="op">(</span>type<span class="op">**</span><span class="pp"> </span>tree<span class="op">,</span><span class="pp"> </span>type<span class="op">*</span><span class="pp"> </span>old<span class="op">,</span><span class="pp"> </span>type<span class="op">*</span><span class="pp"> </span><span class="kw">new</span><span class="op">);</span><span class="pp">                 </span><span class="op">\</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="dt">int</span><span class="pp">  </span>cx<span class="pp">##</span>_replace<span class="op">(</span>type<span class="op">**</span><span class="pp"> </span>tree<span class="op">,</span><span class="pp"> </span>type<span class="op">*</span><span class="pp"> </span>key<span class="op">,</span><span class="pp"> </span>type<span class="op">*</span><span class="pp"> </span><span class="kw">new</span><span class="op">,</span><span class="pp"> </span>type<span class="op">**</span><span class="pp"> </span>old<span class="op">);</span><span class="pp">          </span><span class="op">\</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="dt">int</span><span class="pp">  </span>cx<span class="pp">##</span>_find<span class="op">(</span>type<span class="op">*</span><span class="pp"> </span>tree<span class="op">,</span><span class="pp"> </span>type<span class="op">*</span><span class="pp"> </span>key<span class="op">,</span><span class="pp"> </span>type<span class="op">**</span><span class="pp"> </span>node<span class="op">);</span><span class="pp">                        </span><span class="op">\</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span>RB_SIZE_T<span class="pp">                                                                  </span><span class="op">\</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span>cx<span class="pp">##</span>_size<span class="op">(</span>type<span class="op">*</span><span class="pp"> </span>tree<span class="op">);</span><span class="pp">                                                     </span><span class="op">\</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span>rb_bind_decl_debug_cx_m<span class="op">(</span>cx<span class="op">,</span><span class="pp"> </span>type<span class="op">)</span></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a><span class="pp">#ifndef RB_NO_CHECK</span></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a><span class="pp">#define rb_bind_decl_debug_cx_m</span><span class="op">(</span>cx<span class="op">,</span><span class="pp"> </span>type<span class="op">)</span><span class="pp">                                      </span><span class="op">\</span></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="dt">void</span><span class="pp"> </span>cx<span class="pp">##</span>_check_tree<span class="op">(</span>type<span class="op">*</span><span class="pp"> </span>tree<span class="op">);</span><span class="pp">                                          </span><span class="op">\</span></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="dt">void</span><span class="pp"> </span>cx<span class="pp">##</span>_check_tree_rec<span class="op">(</span>type<span class="op">*</span><span class="pp"> </span>node<span class="op">,</span><span class="pp"> </span><span class="dt">int</span><span class="pp"> </span>depth<span class="op">,</span><span class="pp"> </span><span class="dt">int</span><span class="op">*</span><span class="pp"> </span>pathdepth<span class="op">);</span></span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a><span class="pp">#else</span></span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a><span class="pp">#define rb_bind_decl_debug_cx_m</span><span class="op">(</span>cx<span class="op">,</span><span class="pp"> </span>type<span class="op">)</span></span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a><span class="pp">#define rb_bind_decl_m</span><span class="op">(</span>cx<span class="op">,</span><span class="pp"> </span>type<span class="op">)</span><span class="pp"> </span>rb_bind_decl_cx_m<span class="op">(</span>cx<span class="op">,</span><span class="pp"> </span>type<span class="op">)</span></span></code></pre></div>
<h2 id="rb_bind_impl_m">rb_bind_impl_m</h2>
<p>Bind rbtree functions to a context. This only generates implementations.</p>
<p>rb_bind_impl_m uses the standard traits: rb_color_m, rb_parent_m, rb_left_m, rb_right_m, whereas rb_bind_impl_cx_m expects you to create: cx##_color_m, cx##_parent_m, cx##_left_m, cx##_right_m.</p>
<dl class="incremental">
<dt>cx</dt>
<dd><p>Name of the new context.</p>
</dd>
<dt>type</dt>
<dd><p>The type of the nodes in the red-black tree.</p>
</dd>
</dl>
<div class="sourceCode" id="cb40"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#define _rb_bind_impl_tr_m</span><span class="op">(</span>cx<span class="op">,</span><span class="pp"> </span>type<span class="op">,</span><span class="pp"> </span>color<span class="op">,</span><span class="pp"> </span>parent<span class="op">,</span><span class="pp"> </span>left<span class="op">,</span><span class="pp"> </span>right<span class="op">,</span><span class="pp"> </span>cmp<span class="op">)</span><span class="pp">          </span><span class="op">\</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span>cx<span class="pp">##</span>_type_t<span class="pp">        </span>cx<span class="pp">##</span>_nil_mem<span class="op">;</span><span class="pp">                                           </span><span class="op">\</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span>cx<span class="pp">##</span>_type_t<span class="op">*</span><span class="pp"> </span><span class="at">const</span><span class="pp"> </span>cx<span class="pp">##</span>_nil_ptr<span class="pp"> </span><span class="op">=</span><span class="pp"> </span><span class="op">&amp;</span>cx<span class="pp">##</span>_nil_mem<span class="op">;</span><span class="pp">                           </span><span class="op">\</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="dt">void</span><span class="pp">               </span>cx<span class="pp">##</span>_tree_init<span class="op">(</span>type<span class="op">**</span><span class="pp"> </span>tree<span class="op">)</span><span class="pp">                             </span><span class="op">\</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="op">{</span><span class="pp">                                                                          </span><span class="op">\</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>rb_node_init_m<span class="op">(</span><span class="pp">                                                        </span><span class="op">\</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>cx<span class="pp">##</span>_nil_ptr<span class="op">,</span><span class="pp"> </span>color<span class="op">,</span><span class="pp"> </span>parent<span class="op">,</span><span class="pp"> </span>left<span class="op">,</span><span class="pp"> </span>right<span class="op">,</span><span class="pp"> </span>cx<span class="pp">##</span>_nil_ptr<span class="op">);</span><span class="pp">       </span><span class="op">\</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="op">*</span>tree<span class="pp"> </span><span class="op">=</span><span class="pp"> </span>cx<span class="pp">##</span>_nil_ptr<span class="op">;</span><span class="pp">                                                  </span><span class="op">\</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="op">}</span><span class="pp">                                                                          </span><span class="op">\</span></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="dt">void</span><span class="pp"> </span>cx<span class="pp">##</span>_iter_init<span class="op">(</span>type<span class="op">*</span><span class="pp"> </span>tree<span class="op">,</span><span class="pp"> </span>cx<span class="pp">##</span>_iter_t<span class="op">**</span><span class="pp"> </span>iter<span class="op">,</span><span class="pp"> </span>type<span class="op">**</span><span class="pp"> </span>elem<span class="op">)</span><span class="pp">           </span><span class="op">\</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="op">{</span><span class="pp">                                                                          </span><span class="op">\</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="op">(</span><span class="dt">void</span><span class="op">)</span><span class="pp"> </span><span class="op">(</span>iter<span class="op">);</span><span class="pp">                                                         </span><span class="op">\</span></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>rb_iter_init_m<span class="op">(</span>cx<span class="pp">##</span>_nil_ptr<span class="op">,</span><span class="pp"> </span>left<span class="op">,</span><span class="pp"> </span>tree<span class="op">,</span><span class="pp"> </span><span class="op">*</span>elem<span class="op">);</span><span class="pp">                       </span><span class="op">\</span></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="op">}</span><span class="pp">                                                                          </span><span class="op">\</span></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="dt">void</span><span class="pp"> </span>cx<span class="pp">##</span>_iter_next<span class="op">(</span>cx<span class="pp">##</span>_iter_t<span class="op">*</span><span class="pp"> </span>iter<span class="op">,</span><span class="pp"> </span>type<span class="op">**</span><span class="pp"> </span>elem<span class="op">)</span><span class="pp">                        </span><span class="op">\</span></span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="op">{</span><span class="pp">                                                                          </span><span class="op">\</span></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="op">(</span><span class="dt">void</span><span class="op">)</span><span class="pp"> </span><span class="op">(</span>iter<span class="op">);</span><span class="pp">                                                         </span><span class="op">\</span></span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>rb_iter_next_m<span class="op">(</span>cx<span class="pp">##</span>_nil_ptr<span class="op">,</span><span class="pp"> </span>type<span class="op">,</span><span class="pp"> </span>parent<span class="op">,</span><span class="pp"> </span>left<span class="op">,</span><span class="pp"> </span>right<span class="op">,</span><span class="pp"> </span><span class="op">*</span>elem<span class="op">)</span><span class="pp">         </span><span class="op">\</span></span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="op">}</span><span class="pp">                                                                          </span><span class="op">\</span></span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="dt">void</span><span class="pp"> </span>cx<span class="pp">##</span>_node_init<span class="op">(</span>type<span class="op">*</span><span class="pp"> </span>node<span class="op">)</span><span class="pp">                                            </span><span class="op">\</span></span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="op">{</span><span class="pp">                                                                          </span><span class="op">\</span></span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>rb_node_init_m<span class="op">(</span>cx<span class="pp">##</span>_nil_ptr<span class="op">,</span><span class="pp"> </span>color<span class="op">,</span><span class="pp"> </span>parent<span class="op">,</span><span class="pp"> </span>left<span class="op">,</span><span class="pp"> </span>right<span class="op">,</span><span class="pp"> </span>node<span class="op">);</span><span class="pp">        </span><span class="op">\</span></span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="op">}</span><span class="pp">                                                                          </span><span class="op">\</span></span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="dt">int</span><span class="pp"> </span>cx<span class="pp">##</span>_insert<span class="op">(</span>type<span class="op">**</span><span class="pp"> </span>tree<span class="op">,</span><span class="pp"> </span>type<span class="op">*</span><span class="pp"> </span>node<span class="op">)</span><span class="pp">                                   </span><span class="op">\</span></span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="op">{</span><span class="pp">                                                                          </span><span class="op">\</span></span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>rb_insert_m<span class="op">(</span><span class="pp">                                                           </span><span class="op">\</span></span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>type<span class="op">,</span><span class="pp">                                                          </span><span class="op">\</span></span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>cx<span class="pp">##</span>_nil_ptr<span class="op">,</span><span class="pp">                                                  </span><span class="op">\</span></span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>color<span class="op">,</span><span class="pp">                                                         </span><span class="op">\</span></span>
<span id="cb40-30"><a href="#cb40-30" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>parent<span class="op">,</span><span class="pp">                                                        </span><span class="op">\</span></span>
<span id="cb40-31"><a href="#cb40-31" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>left<span class="op">,</span><span class="pp">                                                          </span><span class="op">\</span></span>
<span id="cb40-32"><a href="#cb40-32" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>right<span class="op">,</span><span class="pp">                                                         </span><span class="op">\</span></span>
<span id="cb40-33"><a href="#cb40-33" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>cmp<span class="op">,</span><span class="pp">                                                           </span><span class="op">\</span></span>
<span id="cb40-34"><a href="#cb40-34" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span><span class="op">*</span>tree<span class="op">,</span><span class="pp">                                                         </span><span class="op">\</span></span>
<span id="cb40-35"><a href="#cb40-35" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>node<span class="op">);</span><span class="pp">                                                         </span><span class="op">\</span></span>
<span id="cb40-36"><a href="#cb40-36" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="cf">return</span><span class="pp"> </span><span class="op">!(</span><span class="pp">                                                              </span><span class="op">\</span></span>
<span id="cb40-37"><a href="#cb40-37" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>parent<span class="op">(</span>node<span class="op">)</span><span class="pp"> </span><span class="op">!=</span><span class="pp"> </span>cx<span class="pp">##</span>_nil_ptr<span class="pp"> </span><span class="op">||</span><span class="pp"> </span>left<span class="op">(</span>node<span class="op">)</span><span class="pp"> </span><span class="op">!=</span><span class="pp"> </span>cx<span class="pp">##</span>_nil_ptr<span class="pp"> </span><span class="op">||</span><span class="pp">  </span><span class="op">\</span></span>
<span id="cb40-38"><a href="#cb40-38" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>right<span class="op">(</span>node<span class="op">)</span><span class="pp"> </span><span class="op">!=</span><span class="pp"> </span>cx<span class="pp">##</span>_nil_ptr<span class="pp"> </span><span class="op">||</span><span class="pp"> </span><span class="op">*</span>tree<span class="pp"> </span><span class="op">==</span><span class="pp"> </span>node<span class="op">);</span><span class="pp">                 </span><span class="op">\</span></span>
<span id="cb40-39"><a href="#cb40-39" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="op">}</span><span class="pp">                                                                          </span><span class="op">\</span></span>
<span id="cb40-40"><a href="#cb40-40" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="dt">void</span><span class="pp"> </span>cx<span class="pp">##</span>_delete_node<span class="op">(</span>type<span class="op">**</span><span class="pp"> </span>tree<span class="op">,</span><span class="pp"> </span>type<span class="op">*</span><span class="pp"> </span>node<span class="op">)</span><span class="pp"> </span>rb_delete_node_m<span class="op">(</span><span class="pp">           </span><span class="op">\</span></span>
<span id="cb40-41"><a href="#cb40-41" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>type<span class="op">,</span><span class="pp"> </span>cx<span class="pp">##</span>_nil_ptr<span class="op">,</span><span class="pp"> </span>color<span class="op">,</span><span class="pp"> </span>parent<span class="op">,</span><span class="pp"> </span>left<span class="op">,</span><span class="pp"> </span>right<span class="op">,</span><span class="pp"> </span><span class="op">*</span>tree<span class="op">,</span><span class="pp"> </span>node<span class="op">)</span><span class="pp"> </span><span class="dt">int</span><span class="pp">   </span><span class="op">\</span></span>
<span id="cb40-42"><a href="#cb40-42" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>cx<span class="pp">##</span>_delete<span class="op">(</span>type<span class="op">**</span><span class="pp"> </span>tree<span class="op">,</span><span class="pp"> </span>type<span class="op">*</span><span class="pp"> </span>key<span class="op">,</span><span class="pp"> </span>type<span class="op">**</span><span class="pp"> </span>node<span class="op">)</span><span class="pp">                   </span><span class="op">\</span></span>
<span id="cb40-43"><a href="#cb40-43" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="op">{</span><span class="pp">                                                                          </span><span class="op">\</span></span>
<span id="cb40-44"><a href="#cb40-44" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="cf">if</span><span class="pp"> </span><span class="op">(</span>cx<span class="pp">##</span>_find<span class="op">(*</span>tree<span class="op">,</span><span class="pp"> </span>key<span class="op">,</span><span class="pp"> </span>node<span class="op">)</span><span class="pp"> </span><span class="op">==</span><span class="pp"> </span><span class="dv">0</span><span class="op">)</span><span class="pp"> </span><span class="op">{</span><span class="pp">                                </span><span class="op">\</span></span>
<span id="cb40-45"><a href="#cb40-45" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>cx<span class="pp">##</span>_delete_node<span class="op">(</span>tree<span class="op">,</span><span class="pp"> </span><span class="op">*</span>node<span class="op">);</span><span class="pp">                                     </span><span class="op">\</span></span>
<span id="cb40-46"><a href="#cb40-46" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="cf">return</span><span class="pp"> </span><span class="dv">0</span><span class="op">;</span><span class="pp">                                                          </span><span class="op">\</span></span>
<span id="cb40-47"><a href="#cb40-47" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="op">}</span><span class="pp">                                                                      </span><span class="op">\</span></span>
<span id="cb40-48"><a href="#cb40-48" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="cf">return</span><span class="pp"> </span><span class="dv">1</span><span class="op">;</span><span class="pp">                                                              </span><span class="op">\</span></span>
<span id="cb40-49"><a href="#cb40-49" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="op">}</span><span class="pp">                                                                          </span><span class="op">\</span></span>
<span id="cb40-50"><a href="#cb40-50" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="dt">int</span><span class="pp"> </span>cx<span class="pp">##</span>_replace_node<span class="op">(</span>type<span class="op">**</span><span class="pp"> </span>tree<span class="op">,</span><span class="pp"> </span>type<span class="op">*</span><span class="pp"> </span>old<span class="op">,</span><span class="pp"> </span>type<span class="op">*</span><span class="pp"> </span><span class="kw">new</span><span class="op">)</span><span class="pp">                   </span><span class="op">\</span></span>
<span id="cb40-51"><a href="#cb40-51" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="op">{</span><span class="pp">                                                                          </span><span class="op">\</span></span>
<span id="cb40-52"><a href="#cb40-52" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>rb_replace_node_m<span class="op">(</span><span class="pp">                                                     </span><span class="op">\</span></span>
<span id="cb40-53"><a href="#cb40-53" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>type<span class="op">,</span><span class="pp">                                                          </span><span class="op">\</span></span>
<span id="cb40-54"><a href="#cb40-54" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>cx<span class="pp">##</span>_nil_ptr<span class="op">,</span><span class="pp">                                                  </span><span class="op">\</span></span>
<span id="cb40-55"><a href="#cb40-55" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>color<span class="op">,</span><span class="pp">                                                         </span><span class="op">\</span></span>
<span id="cb40-56"><a href="#cb40-56" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>parent<span class="op">,</span><span class="pp">                                                        </span><span class="op">\</span></span>
<span id="cb40-57"><a href="#cb40-57" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>left<span class="op">,</span><span class="pp">                                                          </span><span class="op">\</span></span>
<span id="cb40-58"><a href="#cb40-58" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>right<span class="op">,</span><span class="pp">                                                         </span><span class="op">\</span></span>
<span id="cb40-59"><a href="#cb40-59" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>cmp<span class="op">,</span><span class="pp">                                                           </span><span class="op">\</span></span>
<span id="cb40-60"><a href="#cb40-60" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span><span class="op">*</span>tree<span class="op">,</span><span class="pp">                                                         </span><span class="op">\</span></span>
<span id="cb40-61"><a href="#cb40-61" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>old<span class="op">,</span><span class="pp">                                                           </span><span class="op">\</span></span>
<span id="cb40-62"><a href="#cb40-62" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span><span class="kw">new</span><span class="op">);</span><span class="pp">                                                          </span><span class="op">\</span></span>
<span id="cb40-63"><a href="#cb40-63" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="cf">return</span><span class="pp"> </span><span class="op">!(</span><span class="pp">                                                              </span><span class="op">\</span></span>
<span id="cb40-64"><a href="#cb40-64" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>parent<span class="op">(</span>old<span class="op">)</span><span class="pp"> </span><span class="op">==</span><span class="pp"> </span>cx<span class="pp">##</span>_nil_ptr<span class="pp"> </span><span class="op">&amp;&amp;</span><span class="pp"> </span>left<span class="op">(</span>old<span class="op">)</span><span class="pp"> </span><span class="op">==</span><span class="pp"> </span>cx<span class="pp">##</span>_nil_ptr<span class="pp"> </span><span class="op">&amp;&amp;</span><span class="pp">    </span><span class="op">\</span></span>
<span id="cb40-65"><a href="#cb40-65" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>right<span class="op">(</span>old<span class="op">)</span><span class="pp"> </span><span class="op">==</span><span class="pp"> </span>cx<span class="pp">##</span>_nil_ptr<span class="pp"> </span><span class="op">&amp;&amp;</span><span class="pp"> </span>old<span class="pp"> </span><span class="op">!=</span><span class="pp"> </span><span class="op">*</span>tree<span class="op">);</span><span class="pp">                   </span><span class="op">\</span></span>
<span id="cb40-66"><a href="#cb40-66" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="op">}</span><span class="pp">                                                                          </span><span class="op">\</span></span>
<span id="cb40-67"><a href="#cb40-67" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="dt">int</span><span class="pp"> </span>cx<span class="pp">##</span>_replace<span class="op">(</span>type<span class="op">**</span><span class="pp"> </span>tree<span class="op">,</span><span class="pp"> </span>type<span class="op">*</span><span class="pp"> </span>key<span class="op">,</span><span class="pp"> </span>type<span class="op">*</span><span class="pp"> </span><span class="kw">new</span><span class="op">,</span><span class="pp"> </span>type<span class="op">**</span><span class="pp"> </span>old<span class="op">)</span><span class="pp">            </span><span class="op">\</span></span>
<span id="cb40-68"><a href="#cb40-68" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="op">{</span><span class="pp">                                                                          </span><span class="op">\</span></span>
<span id="cb40-69"><a href="#cb40-69" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="cf">if</span><span class="pp"> </span><span class="op">(</span>cx<span class="pp">##</span>_find<span class="op">(*</span>tree<span class="op">,</span><span class="pp"> </span>key<span class="op">,</span><span class="pp"> </span>old<span class="op">)</span><span class="pp"> </span><span class="op">==</span><span class="pp"> </span><span class="dv">0</span><span class="op">)</span><span class="pp"> </span><span class="op">{</span><span class="pp">                                 </span><span class="op">\</span></span>
<span id="cb40-70"><a href="#cb40-70" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="cf">return</span><span class="pp"> </span>cx<span class="pp">##</span>_replace_node<span class="op">(</span>tree<span class="op">,</span><span class="pp"> </span><span class="op">*</span>old<span class="op">,</span><span class="pp"> </span><span class="kw">new</span><span class="op">);</span><span class="pp">                         </span><span class="op">\</span></span>
<span id="cb40-71"><a href="#cb40-71" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="op">}</span><span class="pp">                                                                      </span><span class="op">\</span></span>
<span id="cb40-72"><a href="#cb40-72" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="cf">return</span><span class="pp"> </span><span class="dv">1</span><span class="op">;</span><span class="pp">                                                              </span><span class="op">\</span></span>
<span id="cb40-73"><a href="#cb40-73" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="op">}</span><span class="pp">                                                                          </span><span class="op">\</span></span>
<span id="cb40-74"><a href="#cb40-74" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="dt">int</span><span class="pp"> </span>cx<span class="pp">##</span>_find<span class="op">(</span>type<span class="op">*</span><span class="pp"> </span>tree<span class="op">,</span><span class="pp"> </span>type<span class="op">*</span><span class="pp"> </span>key<span class="op">,</span><span class="pp"> </span>type<span class="op">**</span><span class="pp"> </span>node<span class="op">)</span><span class="pp">                          </span><span class="op">\</span></span>
<span id="cb40-75"><a href="#cb40-75" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="op">{</span><span class="pp">                                                                          </span><span class="op">\</span></span>
<span id="cb40-76"><a href="#cb40-76" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>rb_find_m<span class="op">(</span><span class="pp">                                                             </span><span class="op">\</span></span>
<span id="cb40-77"><a href="#cb40-77" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>type<span class="op">,</span><span class="pp">                                                          </span><span class="op">\</span></span>
<span id="cb40-78"><a href="#cb40-78" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>cx<span class="pp">##</span>_nil_ptr<span class="op">,</span><span class="pp">                                                  </span><span class="op">\</span></span>
<span id="cb40-79"><a href="#cb40-79" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>color<span class="op">,</span><span class="pp">                                                         </span><span class="op">\</span></span>
<span id="cb40-80"><a href="#cb40-80" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>parent<span class="op">,</span><span class="pp">                                                        </span><span class="op">\</span></span>
<span id="cb40-81"><a href="#cb40-81" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>left<span class="op">,</span><span class="pp">                                                          </span><span class="op">\</span></span>
<span id="cb40-82"><a href="#cb40-82" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>right<span class="op">,</span><span class="pp">                                                         </span><span class="op">\</span></span>
<span id="cb40-83"><a href="#cb40-83" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>cmp<span class="op">,</span><span class="pp">                                                           </span><span class="op">\</span></span>
<span id="cb40-84"><a href="#cb40-84" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>tree<span class="op">,</span><span class="pp">                                                          </span><span class="op">\</span></span>
<span id="cb40-85"><a href="#cb40-85" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>key<span class="op">,</span><span class="pp">                                                           </span><span class="op">\</span></span>
<span id="cb40-86"><a href="#cb40-86" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span><span class="op">*</span>node<span class="op">);</span><span class="pp">                                                        </span><span class="op">\</span></span>
<span id="cb40-87"><a href="#cb40-87" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="cf">return</span><span class="pp"> </span><span class="op">*</span>node<span class="pp"> </span><span class="op">==</span><span class="pp"> </span>cx<span class="pp">##</span>_nil_ptr<span class="op">;</span><span class="pp">                                          </span><span class="op">\</span></span>
<span id="cb40-88"><a href="#cb40-88" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="op">}</span><span class="pp">                                                                          </span><span class="op">\</span></span>
<span id="cb40-89"><a href="#cb40-89" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span>RB_SIZE_T<span class="pp">                                                                  </span><span class="op">\</span></span>
<span id="cb40-90"><a href="#cb40-90" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span>cx<span class="pp">##</span>_size<span class="op">(</span>type<span class="op">*</span><span class="pp"> </span>tree<span class="op">)</span><span class="pp">                                                      </span><span class="op">\</span></span>
<span id="cb40-91"><a href="#cb40-91" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="op">{</span><span class="pp">                                                                          </span><span class="op">\</span></span>
<span id="cb40-92"><a href="#cb40-92" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="cf">if</span><span class="pp"> </span><span class="op">(</span>tree<span class="pp"> </span><span class="op">==</span><span class="pp"> </span>cx<span class="pp">##</span>_nil_ptr<span class="op">)</span><span class="pp"> </span><span class="op">{</span><span class="pp">                                            </span><span class="op">\</span></span>
<span id="cb40-93"><a href="#cb40-93" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="cf">return</span><span class="pp"> </span><span class="dv">0</span><span class="op">;</span><span class="pp">                                                          </span><span class="op">\</span></span>
<span id="cb40-94"><a href="#cb40-94" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="op">}</span><span class="pp"> </span><span class="cf">else</span><span class="pp"> </span><span class="op">{</span><span class="pp">                                                               </span><span class="op">\</span></span>
<span id="cb40-95"><a href="#cb40-95" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="cf">return</span><span class="pp"> </span><span class="op">(</span>cx<span class="pp">##</span>_size<span class="op">(</span>left<span class="op">(</span>tree<span class="op">))</span><span class="pp"> </span><span class="op">+</span><span class="pp"> </span>cx<span class="pp">##</span>_size<span class="op">(</span>right<span class="op">(</span>tree<span class="op">))</span><span class="pp"> </span><span class="op">+</span><span class="pp"> </span><span class="dv">1</span><span class="op">);</span><span class="pp">       </span><span class="op">\</span></span>
<span id="cb40-96"><a href="#cb40-96" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="op">}</span><span class="pp">                                                                      </span><span class="op">\</span></span>
<span id="cb40-97"><a href="#cb40-97" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="op">}</span><span class="pp">                                                                          </span><span class="op">\</span></span>
<span id="cb40-98"><a href="#cb40-98" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span>_rb_bind_impl_debug_tr_m<span class="op">(</span>cx<span class="op">,</span><span class="pp"> </span>type<span class="op">,</span><span class="pp"> </span>color<span class="op">,</span><span class="pp"> </span>parent<span class="op">,</span><span class="pp"> </span>left<span class="op">,</span><span class="pp"> </span>right<span class="op">,</span><span class="pp"> </span>cmp<span class="op">)</span></span>
<span id="cb40-99"><a href="#cb40-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-100"><a href="#cb40-100" aria-hidden="true" tabindex="-1"></a><span class="pp">#ifndef RB_NO_CHECK</span></span>
<span id="cb40-101"><a href="#cb40-101" aria-hidden="true" tabindex="-1"></a><span class="pp">#define _rb_bind_impl_debug_tr_m</span><span class="op">(</span>cx<span class="op">,</span><span class="pp"> </span>type<span class="op">,</span><span class="pp"> </span>color<span class="op">,</span><span class="pp"> </span>parent<span class="op">,</span><span class="pp"> </span>left<span class="op">,</span><span class="pp"> </span>right<span class="op">,</span><span class="pp"> </span>cmp<span class="op">)</span><span class="pp">    </span><span class="op">\</span></span>
<span id="cb40-102"><a href="#cb40-102" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="dt">void</span><span class="pp"> </span>cx<span class="pp">##</span>_check_tree<span class="op">(</span>type<span class="op">*</span><span class="pp"> </span>tree<span class="op">)</span><span class="pp">                                           </span><span class="op">\</span></span>
<span id="cb40-103"><a href="#cb40-103" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="op">{</span><span class="pp">                                                                          </span><span class="op">\</span></span>
<span id="cb40-104"><a href="#cb40-104" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="dt">int</span><span class="pp"> </span>pathdepth<span class="pp"> </span><span class="op">=</span><span class="pp"> </span><span class="op">-</span><span class="dv">1</span><span class="op">;</span><span class="pp">                                                    </span><span class="op">\</span></span>
<span id="cb40-105"><a href="#cb40-105" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>cx<span class="pp">##</span>_check_tree_rec<span class="op">(</span>tree<span class="op">,</span><span class="pp"> </span><span class="dv">0</span><span class="op">,</span><span class="pp"> </span><span class="op">&amp;</span>pathdepth<span class="op">);</span><span class="pp">                              </span><span class="op">\</span></span>
<span id="cb40-106"><a href="#cb40-106" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="op">}</span><span class="pp">                                                                          </span><span class="op">\</span></span>
<span id="cb40-107"><a href="#cb40-107" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="dt">void</span><span class="pp"> </span>cx<span class="pp">##</span>_check_tree_rec<span class="op">(</span>type<span class="op">*</span><span class="pp"> </span>node<span class="op">,</span><span class="pp"> </span><span class="dt">int</span><span class="pp"> </span>depth<span class="op">,</span><span class="pp"> </span><span class="dt">int</span><span class="op">*</span><span class="pp"> </span>pathdepth<span class="op">)</span><span class="pp">            </span><span class="op">\</span></span>
<span id="cb40-108"><a href="#cb40-108" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>rb_check_tree_m<span class="op">(</span><span class="pp">                                                   </span><span class="op">\</span></span>
<span id="cb40-109"><a href="#cb40-109" aria-hidden="true" tabindex="-1"></a><span class="pp">                    </span>cx<span class="op">,</span><span class="pp">                                                        </span><span class="op">\</span></span>
<span id="cb40-110"><a href="#cb40-110" aria-hidden="true" tabindex="-1"></a><span class="pp">                    </span>type<span class="op">,</span><span class="pp">                                                      </span><span class="op">\</span></span>
<span id="cb40-111"><a href="#cb40-111" aria-hidden="true" tabindex="-1"></a><span class="pp">                    </span>color<span class="op">,</span><span class="pp">                                                     </span><span class="op">\</span></span>
<span id="cb40-112"><a href="#cb40-112" aria-hidden="true" tabindex="-1"></a><span class="pp">                    </span>parent<span class="op">,</span><span class="pp">                                                    </span><span class="op">\</span></span>
<span id="cb40-113"><a href="#cb40-113" aria-hidden="true" tabindex="-1"></a><span class="pp">                    </span>left<span class="op">,</span><span class="pp">                                                      </span><span class="op">\</span></span>
<span id="cb40-114"><a href="#cb40-114" aria-hidden="true" tabindex="-1"></a><span class="pp">                    </span>right<span class="op">,</span><span class="pp">                                                     </span><span class="op">\</span></span>
<span id="cb40-115"><a href="#cb40-115" aria-hidden="true" tabindex="-1"></a><span class="pp">                    </span>cmp<span class="op">,</span><span class="pp">                                                       </span><span class="op">\</span></span>
<span id="cb40-116"><a href="#cb40-116" aria-hidden="true" tabindex="-1"></a><span class="pp">                    </span>node<span class="op">,</span><span class="pp">                                                      </span><span class="op">\</span></span>
<span id="cb40-117"><a href="#cb40-117" aria-hidden="true" tabindex="-1"></a><span class="pp">                    </span>depth<span class="op">,</span><span class="pp">                                                     </span><span class="op">\</span></span>
<span id="cb40-118"><a href="#cb40-118" aria-hidden="true" tabindex="-1"></a><span class="pp">                    </span><span class="op">*</span>pathdepth<span class="op">)</span></span>
<span id="cb40-119"><a href="#cb40-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-120"><a href="#cb40-120" aria-hidden="true" tabindex="-1"></a><span class="pp">#else</span></span>
<span id="cb40-121"><a href="#cb40-121" aria-hidden="true" tabindex="-1"></a><span class="pp">#define _rb_bind_impl_debug_tr_m</span><span class="op">(</span>cx<span class="op">,</span><span class="pp"> </span>type<span class="op">,</span><span class="pp"> </span>color<span class="op">,</span><span class="pp"> </span>parent<span class="op">,</span><span class="pp"> </span>left<span class="op">,</span><span class="pp"> </span>right<span class="op">,</span><span class="pp"> </span>cmp<span class="op">)</span></span>
<span id="cb40-122"><a href="#cb40-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-123"><a href="#cb40-123" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span>
<span id="cb40-124"><a href="#cb40-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-125"><a href="#cb40-125" aria-hidden="true" tabindex="-1"></a><span class="pp">#define rb_bind_impl_cx_m</span><span class="op">(</span>cx<span class="op">,</span><span class="pp"> </span>type<span class="op">)</span><span class="pp">                                            </span><span class="op">\</span></span>
<span id="cb40-126"><a href="#cb40-126" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span>_rb_bind_impl_tr_m<span class="op">(</span><span class="pp">                                                        </span><span class="op">\</span></span>
<span id="cb40-127"><a href="#cb40-127" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>cx<span class="op">,</span><span class="pp">                                                                </span><span class="op">\</span></span>
<span id="cb40-128"><a href="#cb40-128" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>type<span class="op">,</span><span class="pp">                                                              </span><span class="op">\</span></span>
<span id="cb40-129"><a href="#cb40-129" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>cx<span class="pp">##</span>_color_m<span class="op">,</span><span class="pp">                                                      </span><span class="op">\</span></span>
<span id="cb40-130"><a href="#cb40-130" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>cx<span class="pp">##</span>_parent_m<span class="op">,</span><span class="pp">                                                     </span><span class="op">\</span></span>
<span id="cb40-131"><a href="#cb40-131" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>cx<span class="pp">##</span>_left_m<span class="op">,</span><span class="pp">                                                       </span><span class="op">\</span></span>
<span id="cb40-132"><a href="#cb40-132" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>cx<span class="pp">##</span>_right_m<span class="op">,</span><span class="pp">                                                      </span><span class="op">\</span></span>
<span id="cb40-133"><a href="#cb40-133" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>cx<span class="pp">##</span>_cmp_m<span class="op">)</span></span>
<span id="cb40-134"><a href="#cb40-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-135"><a href="#cb40-135" aria-hidden="true" tabindex="-1"></a><span class="pp">#define rb_bind_impl_m</span><span class="op">(</span>cx<span class="op">,</span><span class="pp"> </span>type<span class="op">)</span><span class="pp">                                               </span><span class="op">\</span></span>
<span id="cb40-136"><a href="#cb40-136" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span>_rb_bind_impl_tr_m<span class="op">(</span><span class="pp">                                                        </span><span class="op">\</span></span>
<span id="cb40-137"><a href="#cb40-137" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>cx<span class="op">,</span><span class="pp">                                                                </span><span class="op">\</span></span>
<span id="cb40-138"><a href="#cb40-138" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>type<span class="op">,</span><span class="pp">                                                              </span><span class="op">\</span></span>
<span id="cb40-139"><a href="#cb40-139" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>rb_color_m<span class="op">,</span><span class="pp">                                                        </span><span class="op">\</span></span>
<span id="cb40-140"><a href="#cb40-140" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>rb_parent_m<span class="op">,</span><span class="pp">                                                       </span><span class="op">\</span></span>
<span id="cb40-141"><a href="#cb40-141" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>rb_left_m<span class="op">,</span><span class="pp">                                                         </span><span class="op">\</span></span>
<span id="cb40-142"><a href="#cb40-142" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>rb_right_m<span class="op">,</span><span class="pp">                                                        </span><span class="op">\</span></span>
<span id="cb40-143"><a href="#cb40-143" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>cx<span class="pp">##</span>_cmp_m<span class="op">)</span></span>
<span id="cb40-144"><a href="#cb40-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-145"><a href="#cb40-145" aria-hidden="true" tabindex="-1"></a><span class="pp">#define rb_bind_cx_m</span><span class="op">(</span>cx<span class="op">,</span><span class="pp"> </span>type<span class="op">)</span><span class="pp">                                                 </span><span class="op">\</span></span>
<span id="cb40-146"><a href="#cb40-146" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span>rb_bind_decl_cx_m<span class="op">(</span>cx<span class="op">,</span><span class="pp"> </span>type<span class="op">)</span><span class="pp"> </span>rb_bind_impl_cx_m<span class="op">(</span>cx<span class="op">,</span><span class="pp"> </span>type<span class="op">)</span></span>
<span id="cb40-147"><a href="#cb40-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-148"><a href="#cb40-148" aria-hidden="true" tabindex="-1"></a><span class="pp">#define rb_bind_m</span><span class="op">(</span>cx<span class="op">,</span><span class="pp"> </span>type<span class="op">)</span><span class="pp"> </span>rb_bind_decl_m<span class="op">(</span>cx<span class="op">,</span><span class="pp"> </span>type<span class="op">)</span><span class="pp"> </span>rb_bind_impl_m<span class="op">(</span>cx<span class="op">,</span><span class="pp"> </span>type<span class="op">)</span></span></code></pre></div>
<h2 id="rb_check_tree_m">rb_check_tree_m</h2>
<p>Recursive: only works bound cx##_check_tree</p>
<p>Check consistency of a tree</p>
<dl class="incremental">
<dt>node</dt>
<dd><p>Node to check.</p>
</dd>
<dt>result</dt>
<dd><p>Zero on success, other on failure.</p>
</dd>
</dl>
<div class="sourceCode" id="cb41"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#define _rb_check_tree_m</span><span class="op">(</span><span class="pp">                                                      </span><span class="op">\</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>cx<span class="op">,</span><span class="pp">                                                                    </span><span class="op">\</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>type<span class="op">,</span><span class="pp">                                                                  </span><span class="op">\</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>color<span class="op">,</span><span class="pp">                                                                 </span><span class="op">\</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>parent<span class="op">,</span><span class="pp">                                                                </span><span class="op">\</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>left<span class="op">,</span><span class="pp">                                                                  </span><span class="op">\</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>right<span class="op">,</span><span class="pp">                                                                 </span><span class="op">\</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>cmp<span class="op">,</span><span class="pp">                                                                   </span><span class="op">\</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>node<span class="op">,</span><span class="pp">                                                                  </span><span class="op">\</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>depth<span class="op">,</span><span class="pp">                                                                 </span><span class="op">\</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>pathdepth<span class="op">,</span><span class="pp">                                                             </span><span class="op">\</span></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>tmp<span class="op">)</span><span class="pp">                                                                   </span><span class="op">\</span></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="op">{</span><span class="pp">                                                                          </span><span class="op">\</span></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>type<span class="op">*</span><span class="pp"> </span>nil<span class="pp"> </span><span class="op">=</span><span class="pp"> </span>cx<span class="pp">##</span>_nil_ptr<span class="op">;</span><span class="pp">                                              </span><span class="op">\</span></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="cf">if</span><span class="pp"> </span><span class="op">(</span>node<span class="pp"> </span><span class="op">==</span><span class="pp"> </span>nil<span class="op">)</span><span class="pp"> </span><span class="op">{</span><span class="pp">                                                     </span><span class="op">\</span></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="cf">if</span><span class="pp"> </span><span class="op">(</span>pathdepth<span class="pp"> </span><span class="op">&lt;</span><span class="pp"> </span><span class="dv">0</span><span class="op">)</span><span class="pp"> </span><span class="op">{</span><span class="pp">                                               </span><span class="op">\</span></span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>pathdepth<span class="pp"> </span><span class="op">=</span><span class="pp"> </span>depth<span class="op">;</span><span class="pp">                                             </span><span class="op">\</span></span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="op">}</span><span class="pp"> </span><span class="cf">else</span><span class="pp"> </span><span class="op">{</span><span class="pp">                                                           </span><span class="op">\</span></span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span><span class="ot">assert</span><span class="op">(</span>pathdepth<span class="pp"> </span><span class="op">==</span><span class="pp"> </span>depth<span class="op">);</span><span class="pp">                                    </span><span class="op">\</span></span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="op">}</span><span class="pp">                                                                  </span><span class="op">\</span></span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="op">}</span><span class="pp"> </span><span class="cf">else</span><span class="pp"> </span><span class="op">{</span><span class="pp">                                                               </span><span class="op">\</span></span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>tmp<span class="pp"> </span><span class="op">=</span><span class="pp"> </span>left<span class="op">(</span>node<span class="op">);</span><span class="pp">                                                  </span><span class="op">\</span></span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="cf">if</span><span class="pp"> </span><span class="op">(</span>tmp<span class="pp"> </span><span class="op">!=</span><span class="pp"> </span>nil<span class="op">)</span><span class="pp"> </span><span class="op">{</span><span class="pp">                                                  </span><span class="op">\</span></span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span><span class="ot">assert</span><span class="op">(</span>parent<span class="op">(</span>tmp<span class="op">)</span><span class="pp"> </span><span class="op">==</span><span class="pp"> </span>node<span class="op">);</span><span class="pp">                                   </span><span class="op">\</span></span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span><span class="ot">assert</span><span class="op">(</span>cmp<span class="op">((</span>tmp<span class="op">),</span><span class="pp"> </span><span class="op">(</span>node<span class="op">))</span><span class="pp"> </span><span class="op">&lt;</span><span class="pp"> </span><span class="dv">0</span><span class="op">);</span><span class="pp">                                </span><span class="op">\</span></span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="op">}</span><span class="pp">                                                                  </span><span class="op">\</span></span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>tmp<span class="pp"> </span><span class="op">=</span><span class="pp"> </span>right<span class="op">(</span>node<span class="op">);</span><span class="pp">                                                 </span><span class="op">\</span></span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="cf">if</span><span class="pp"> </span><span class="op">(</span>tmp<span class="pp"> </span><span class="op">!=</span><span class="pp"> </span>nil<span class="op">)</span><span class="pp"> </span><span class="op">{</span><span class="pp">                                                  </span><span class="op">\</span></span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span><span class="ot">assert</span><span class="op">(</span>parent<span class="op">(</span>tmp<span class="op">)</span><span class="pp"> </span><span class="op">==</span><span class="pp"> </span>node<span class="op">);</span><span class="pp">                                   </span><span class="op">\</span></span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span><span class="ot">assert</span><span class="op">(</span>cmp<span class="op">((</span>tmp<span class="op">),</span><span class="pp"> </span><span class="op">(</span>node<span class="op">))</span><span class="pp"> </span><span class="op">&gt;</span><span class="pp"> </span><span class="dv">0</span><span class="op">);</span><span class="pp">                                </span><span class="op">\</span></span>
<span id="cb41-31"><a href="#cb41-31" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="op">}</span><span class="pp">                                                                  </span><span class="op">\</span></span>
<span id="cb41-32"><a href="#cb41-32" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="cf">if</span><span class="pp"> </span><span class="op">(</span>rb_is_red_m<span class="op">(</span>color<span class="op">(</span>node<span class="op">)))</span><span class="pp"> </span><span class="op">{</span><span class="pp">                                    </span><span class="op">\</span></span>
<span id="cb41-33"><a href="#cb41-33" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>tmp<span class="pp"> </span><span class="op">=</span><span class="pp"> </span>left<span class="op">(</span>node<span class="op">);</span><span class="pp">                                              </span><span class="op">\</span></span>
<span id="cb41-34"><a href="#cb41-34" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span><span class="cf">if</span><span class="pp"> </span><span class="op">(</span>tmp<span class="pp"> </span><span class="op">!=</span><span class="pp"> </span>nil<span class="op">)</span><span class="pp"> </span><span class="op">{</span><span class="pp">                                              </span><span class="op">\</span></span>
<span id="cb41-35"><a href="#cb41-35" aria-hidden="true" tabindex="-1"></a><span class="pp">                    </span><span class="ot">assert</span><span class="op">(</span>rb_is_black_m<span class="op">(</span>color<span class="op">(</span>tmp<span class="op">)));</span><span class="pp">                         </span><span class="op">\</span></span>
<span id="cb41-36"><a href="#cb41-36" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span><span class="op">}</span><span class="pp">                                                              </span><span class="op">\</span></span>
<span id="cb41-37"><a href="#cb41-37" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>tmp<span class="pp"> </span><span class="op">=</span><span class="pp"> </span>right<span class="op">(</span>node<span class="op">);</span><span class="pp">                                             </span><span class="op">\</span></span>
<span id="cb41-38"><a href="#cb41-38" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span><span class="cf">if</span><span class="pp"> </span><span class="op">(</span>tmp<span class="pp"> </span><span class="op">!=</span><span class="pp"> </span>nil<span class="op">)</span><span class="pp"> </span><span class="op">{</span><span class="pp">                                              </span><span class="op">\</span></span>
<span id="cb41-39"><a href="#cb41-39" aria-hidden="true" tabindex="-1"></a><span class="pp">                    </span><span class="ot">assert</span><span class="op">(</span>rb_is_black_m<span class="op">(</span>color<span class="op">(</span>tmp<span class="op">)));</span><span class="pp">                         </span><span class="op">\</span></span>
<span id="cb41-40"><a href="#cb41-40" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span><span class="op">}</span><span class="pp">                                                              </span><span class="op">\</span></span>
<span id="cb41-41"><a href="#cb41-41" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>cx<span class="pp">##</span>_check_tree_rec<span class="op">(</span>left<span class="op">(</span>node<span class="op">),</span><span class="pp"> </span>depth<span class="op">,</span><span class="pp"> </span><span class="op">&amp;</span>pathdepth<span class="op">);</span><span class="pp">            </span><span class="op">\</span></span>
<span id="cb41-42"><a href="#cb41-42" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>cx<span class="pp">##</span>_check_tree_rec<span class="op">(</span>right<span class="op">(</span>node<span class="op">),</span><span class="pp"> </span>depth<span class="op">,</span><span class="pp"> </span><span class="op">&amp;</span>pathdepth<span class="op">);</span><span class="pp">           </span><span class="op">\</span></span>
<span id="cb41-43"><a href="#cb41-43" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="op">}</span><span class="pp"> </span><span class="cf">else</span><span class="pp"> </span><span class="op">{</span><span class="pp">                                                           </span><span class="op">\</span></span>
<span id="cb41-44"><a href="#cb41-44" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>cx<span class="pp">##</span>_check_tree_rec<span class="op">(</span>left<span class="op">(</span>node<span class="op">),</span><span class="pp"> </span>depth<span class="pp"> </span><span class="op">+</span><span class="pp"> </span><span class="dv">1</span><span class="op">,</span><span class="pp"> </span><span class="op">&amp;</span>pathdepth<span class="op">);</span><span class="pp">        </span><span class="op">\</span></span>
<span id="cb41-45"><a href="#cb41-45" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>cx<span class="pp">##</span>_check_tree_rec<span class="op">(</span>right<span class="op">(</span>node<span class="op">),</span><span class="pp"> </span>depth<span class="pp"> </span><span class="op">+</span><span class="pp"> </span><span class="dv">1</span><span class="op">,</span><span class="pp"> </span><span class="op">&amp;</span>pathdepth<span class="op">);</span><span class="pp">       </span><span class="op">\</span></span>
<span id="cb41-46"><a href="#cb41-46" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="op">}</span><span class="pp">                                                                  </span><span class="op">\</span></span>
<span id="cb41-47"><a href="#cb41-47" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="op">}</span><span class="pp">                                                                      </span><span class="op">\</span></span>
<span id="cb41-48"><a href="#cb41-48" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="op">}</span></span>
<span id="cb41-49"><a href="#cb41-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-50"><a href="#cb41-50" aria-hidden="true" tabindex="-1"></a><span class="pp">#define rb_check_tree_m</span><span class="op">(</span><span class="pp">                                                       </span><span class="op">\</span></span>
<span id="cb41-51"><a href="#cb41-51" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>cx<span class="op">,</span><span class="pp"> </span>type<span class="op">,</span><span class="pp"> </span>color<span class="op">,</span><span class="pp"> </span>parent<span class="op">,</span><span class="pp"> </span>left<span class="op">,</span><span class="pp"> </span>right<span class="op">,</span><span class="pp"> </span>cmp<span class="op">,</span><span class="pp"> </span>node<span class="op">,</span><span class="pp"> </span>depth<span class="op">,</span><span class="pp"> </span>pathdepth<span class="op">)</span><span class="pp">     </span><span class="op">\</span></span>
<span id="cb41-52"><a href="#cb41-52" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="op">{</span><span class="pp">                                                                          </span><span class="op">\</span></span>
<span id="cb41-53"><a href="#cb41-53" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>type<span class="op">*</span><span class="pp"> </span>__rb_check_tmp_<span class="op">;</span><span class="pp">                                                 </span><span class="op">\</span></span>
<span id="cb41-54"><a href="#cb41-54" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>_rb_check_tree_m<span class="op">(</span><span class="pp">                                                      </span><span class="op">\</span></span>
<span id="cb41-55"><a href="#cb41-55" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>cx<span class="op">,</span><span class="pp">                                                            </span><span class="op">\</span></span>
<span id="cb41-56"><a href="#cb41-56" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>type<span class="op">,</span><span class="pp">                                                          </span><span class="op">\</span></span>
<span id="cb41-57"><a href="#cb41-57" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>color<span class="op">,</span><span class="pp">                                                         </span><span class="op">\</span></span>
<span id="cb41-58"><a href="#cb41-58" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>parent<span class="op">,</span><span class="pp">                                                        </span><span class="op">\</span></span>
<span id="cb41-59"><a href="#cb41-59" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>left<span class="op">,</span><span class="pp">                                                          </span><span class="op">\</span></span>
<span id="cb41-60"><a href="#cb41-60" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>right<span class="op">,</span><span class="pp">                                                         </span><span class="op">\</span></span>
<span id="cb41-61"><a href="#cb41-61" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>cmp<span class="op">,</span><span class="pp">                                                           </span><span class="op">\</span></span>
<span id="cb41-62"><a href="#cb41-62" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>node<span class="op">,</span><span class="pp">                                                          </span><span class="op">\</span></span>
<span id="cb41-63"><a href="#cb41-63" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>depth<span class="op">,</span><span class="pp">                                                         </span><span class="op">\</span></span>
<span id="cb41-64"><a href="#cb41-64" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>pathdepth<span class="op">,</span><span class="pp">                                                     </span><span class="op">\</span></span>
<span id="cb41-65"><a href="#cb41-65" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>__rb_check_tmp_<span class="op">)</span><span class="pp">                                               </span><span class="op">\</span></span>
<span id="cb41-66"><a href="#cb41-66" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="op">}</span></span></code></pre></div>
<h1 id="internal">Internal</h1>
<p>Functions that are used internally.</p>
<h2 id="rb_rotate_left_m">_rb_rotate_left_m</h2>
<p>Internal: not bound</p>
<p>A rotation is a local operation in a search tree that preserves in-order traversal key ordering. It is used to fix insert/deletion discrepancies. This operation might change the current root.</p>
<p>_rb_rotate_right_m is _rb_rotate_left_m where left and right had been switched.</p>
<dl class="incremental">
<dt>tree</dt>
<dd><p>The root node of the tree. A pointer to nil represents an empty tree.</p>
</dd>
<dt>node</dt>
<dd><p>The node to initialize.</p>
</dd>
</dl>
<pre class="text"><code>.---.   rotate_right   .---.
| y |     -------&gt;     | x |
.---.                  .---.
/     |                /     |
.---&#39;     .-&#39;-.        .---&#39;      .&#39;--.
| x |     | C |        | A |      | y |
.---.     &#39;---&#39;        &#39;---&#39;      .---.
/     |                           /     |
.-&#39;-.    .&#39;--.                    .-&#39;-.    .&#39;--.
| A |    | B |      &lt;------       | B |    | C |
&#39;---&#39;    &#39;---&#39;    rotate_left     &#39;---&#39;    &#39;---&#39;</code></pre>
<div class="sourceCode" id="cb43"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#define __rb_rotate_left_m</span><span class="op">(</span>nil<span class="op">,</span><span class="pp"> </span>color<span class="op">,</span><span class="pp"> </span>parent<span class="op">,</span><span class="pp"> </span>left<span class="op">,</span><span class="pp"> </span>right<span class="op">,</span><span class="pp"> </span>tree<span class="op">,</span><span class="pp"> </span>node<span class="op">,</span><span class="pp"> </span>x<span class="op">,</span><span class="pp"> </span>y<span class="op">)</span><span class="pp">  </span><span class="op">\</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="op">{</span><span class="pp">                                                                          </span><span class="op">\</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>x<span class="pp"> </span><span class="op">=</span><span class="pp"> </span>node<span class="op">;</span><span class="pp">                                                              </span><span class="op">\</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>y<span class="pp"> </span><span class="op">=</span><span class="pp"> </span>right<span class="op">(</span>x<span class="op">);</span><span class="pp">                                                          </span><span class="op">\</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="pp">                                                                               </span><span class="op">\</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="co">/* Turn y&#39;s left sub-tree into x&#39;s right sub-tree. */</span><span class="pp">                  </span><span class="op">\</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>right<span class="op">(</span>x<span class="op">)</span><span class="pp"> </span><span class="op">=</span><span class="pp"> </span>left<span class="op">(</span>y<span class="op">);</span><span class="pp">                                                    </span><span class="op">\</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="cf">if</span><span class="pp"> </span><span class="op">(</span>left<span class="op">(</span>y<span class="op">)</span><span class="pp"> </span><span class="op">!=</span><span class="pp"> </span>nil<span class="op">)</span><span class="pp"> </span><span class="op">{</span><span class="pp">                                                  </span><span class="op">\</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>parent<span class="op">(</span>left<span class="op">(</span>y<span class="op">))</span><span class="pp"> </span><span class="op">=</span><span class="pp"> </span>x<span class="op">;</span><span class="pp">                                               </span><span class="op">\</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="op">}</span><span class="pp">                                                                      </span><span class="op">\</span></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="co">/* y&#39;s new parent was x&#39;s parent. */</span><span class="pp">                                   </span><span class="op">\</span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>parent<span class="op">(</span>y<span class="op">)</span><span class="pp"> </span><span class="op">=</span><span class="pp"> </span>parent<span class="op">(</span>x<span class="op">);</span><span class="pp">                                                 </span><span class="op">\</span></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="cf">if</span><span class="pp"> </span><span class="op">(</span>parent<span class="op">(</span>x<span class="op">)</span><span class="pp"> </span><span class="op">==</span><span class="pp"> </span>nil<span class="op">)</span><span class="pp"> </span><span class="op">{</span><span class="pp">                                                </span><span class="op">\</span></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="co">/* If x is root y becomes the new root. */</span><span class="pp">                         </span><span class="op">\</span></span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>tree<span class="pp"> </span><span class="op">=</span><span class="pp"> </span>y<span class="op">;</span><span class="pp">                                                          </span><span class="op">\</span></span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="op">}</span><span class="pp"> </span><span class="cf">else</span><span class="pp"> </span><span class="op">{</span><span class="pp">                                                               </span><span class="op">\</span></span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="co">/* Set the parent to point to y instead of x. */</span><span class="pp">                   </span><span class="op">\</span></span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="cf">if</span><span class="pp"> </span><span class="op">(</span>x<span class="pp"> </span><span class="op">==</span><span class="pp"> </span>left<span class="op">(</span>parent<span class="op">(</span>x<span class="op">)))</span><span class="pp"> </span><span class="op">{</span><span class="pp">                                        </span><span class="op">\</span></span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span><span class="co">/* x was on the left of its parent. */</span><span class="pp">                         </span><span class="op">\</span></span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>left<span class="op">(</span>parent<span class="op">(</span>x<span class="op">))</span><span class="pp"> </span><span class="op">=</span><span class="pp"> </span>y<span class="op">;</span><span class="pp">                                           </span><span class="op">\</span></span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="op">}</span><span class="pp"> </span><span class="cf">else</span><span class="pp"> </span><span class="op">{</span><span class="pp">                                                           </span><span class="op">\</span></span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span><span class="co">/* x must have been on the right. */</span><span class="pp">                           </span><span class="op">\</span></span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>right<span class="op">(</span>parent<span class="op">(</span>x<span class="op">))</span><span class="pp"> </span><span class="op">=</span><span class="pp"> </span>y<span class="op">;</span><span class="pp">                                          </span><span class="op">\</span></span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="op">}</span><span class="pp">                                                                  </span><span class="op">\</span></span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="op">}</span><span class="pp">                                                                      </span><span class="op">\</span></span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="co">/* Finally, put x on y&#39;s left. */</span><span class="pp">                                      </span><span class="op">\</span></span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>left<span class="op">(</span>y<span class="op">)</span><span class="pp">   </span><span class="op">=</span><span class="pp"> </span>x<span class="op">;</span><span class="pp">                                                         </span><span class="op">\</span></span>
<span id="cb43-28"><a href="#cb43-28" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>parent<span class="op">(</span>x<span class="op">)</span><span class="pp"> </span><span class="op">=</span><span class="pp"> </span>y<span class="op">;</span><span class="pp">                                                         </span><span class="op">\</span></span>
<span id="cb43-29"><a href="#cb43-29" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="op">}</span></span>
<span id="cb43-30"><a href="#cb43-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-31"><a href="#cb43-31" aria-hidden="true" tabindex="-1"></a><span class="pp">#define _rb_rotate_left_m</span><span class="op">(</span>type<span class="op">,</span><span class="pp"> </span>nil<span class="op">,</span><span class="pp"> </span>color<span class="op">,</span><span class="pp"> </span>parent<span class="op">,</span><span class="pp"> </span>left<span class="op">,</span><span class="pp"> </span>right<span class="op">,</span><span class="pp"> </span>tree<span class="op">,</span><span class="pp"> </span>node<span class="op">)</span><span class="pp">   </span><span class="op">\</span></span>
<span id="cb43-32"><a href="#cb43-32" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="op">{</span><span class="pp">                                                                          </span><span class="op">\</span></span>
<span id="cb43-33"><a href="#cb43-33" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>type<span class="op">*</span><span class="pp"> </span>__rb_rot_x_<span class="op">;</span><span class="pp">                                                     </span><span class="op">\</span></span>
<span id="cb43-34"><a href="#cb43-34" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>type<span class="op">*</span><span class="pp"> </span>__rb_rot_y_<span class="op">;</span><span class="pp">                                                     </span><span class="op">\</span></span>
<span id="cb43-35"><a href="#cb43-35" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>__rb_rotate_left_m<span class="op">(</span><span class="pp">                                                    </span><span class="op">\</span></span>
<span id="cb43-36"><a href="#cb43-36" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>nil<span class="op">,</span><span class="pp">                                                           </span><span class="op">\</span></span>
<span id="cb43-37"><a href="#cb43-37" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>color<span class="op">,</span><span class="pp">                                                         </span><span class="op">\</span></span>
<span id="cb43-38"><a href="#cb43-38" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>parent<span class="op">,</span><span class="pp">                                                        </span><span class="op">\</span></span>
<span id="cb43-39"><a href="#cb43-39" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>left<span class="op">,</span><span class="pp">                                                          </span><span class="op">\</span></span>
<span id="cb43-40"><a href="#cb43-40" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>right<span class="op">,</span><span class="pp">                                                         </span><span class="op">\</span></span>
<span id="cb43-41"><a href="#cb43-41" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>tree<span class="op">,</span><span class="pp">                                                          </span><span class="op">\</span></span>
<span id="cb43-42"><a href="#cb43-42" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>node<span class="op">,</span><span class="pp">                                                          </span><span class="op">\</span></span>
<span id="cb43-43"><a href="#cb43-43" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>__rb_rot_x_<span class="op">,</span><span class="pp">                                                   </span><span class="op">\</span></span>
<span id="cb43-44"><a href="#cb43-44" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>__rb_rot_y_<span class="op">);</span><span class="pp">                                                  </span><span class="op">\</span></span>
<span id="cb43-45"><a href="#cb43-45" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="op">}</span></span>
<span id="cb43-46"><a href="#cb43-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-47"><a href="#cb43-47" aria-hidden="true" tabindex="-1"></a><span class="pp">#define _rb_rotate_left_tr_m</span><span class="op">(</span>cx<span class="op">,</span><span class="pp"> </span>tree<span class="op">,</span><span class="pp"> </span>node<span class="op">)</span><span class="pp">                                   </span><span class="op">\</span></span>
<span id="cb43-48"><a href="#cb43-48" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span>_rb_rotate_left_m<span class="op">(</span><span class="pp">                                                         </span><span class="op">\</span></span>
<span id="cb43-49"><a href="#cb43-49" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>cx<span class="pp">##</span>_type_t<span class="op">,</span><span class="pp">                                                       </span><span class="op">\</span></span>
<span id="cb43-50"><a href="#cb43-50" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>cx<span class="pp">##</span>_nil_ptr<span class="op">,</span><span class="pp">                                                      </span><span class="op">\</span></span>
<span id="cb43-51"><a href="#cb43-51" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>rb_color_m<span class="op">,</span><span class="pp">                                                        </span><span class="op">\</span></span>
<span id="cb43-52"><a href="#cb43-52" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>rb_parent_m<span class="op">,</span><span class="pp">                                                       </span><span class="op">\</span></span>
<span id="cb43-53"><a href="#cb43-53" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>rb_left_m<span class="op">,</span><span class="pp">                                                         </span><span class="op">\</span></span>
<span id="cb43-54"><a href="#cb43-54" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>rb_right_m<span class="op">,</span><span class="pp">                                                        </span><span class="op">\</span></span>
<span id="cb43-55"><a href="#cb43-55" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>tree<span class="op">,</span><span class="pp">                                                              </span><span class="op">\</span></span>
<span id="cb43-56"><a href="#cb43-56" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>node<span class="op">)</span></span>
<span id="cb43-57"><a href="#cb43-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-58"><a href="#cb43-58" aria-hidden="true" tabindex="-1"></a><span class="pp">#define _rb_rotate_right_m</span><span class="op">(</span>type<span class="op">,</span><span class="pp"> </span>nil<span class="op">,</span><span class="pp"> </span>color<span class="op">,</span><span class="pp"> </span>parent<span class="op">,</span><span class="pp"> </span>left<span class="op">,</span><span class="pp"> </span>right<span class="op">,</span><span class="pp"> </span>tree<span class="op">,</span><span class="pp"> </span>node<span class="op">)</span><span class="pp">  </span><span class="op">\</span></span>
<span id="cb43-59"><a href="#cb43-59" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span>_rb_rotate_left_m<span class="op">(</span><span class="pp">                                                         </span><span class="op">\</span></span>
<span id="cb43-60"><a href="#cb43-60" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>type<span class="op">,</span><span class="pp">                                                              </span><span class="op">\</span></span>
<span id="cb43-61"><a href="#cb43-61" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>nil<span class="op">,</span><span class="pp">                                                               </span><span class="op">\</span></span>
<span id="cb43-62"><a href="#cb43-62" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>color<span class="op">,</span><span class="pp">                                                             </span><span class="op">\</span></span>
<span id="cb43-63"><a href="#cb43-63" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>parent<span class="op">,</span><span class="pp">                                                            </span><span class="op">\</span></span>
<span id="cb43-64"><a href="#cb43-64" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>right<span class="op">,</span><span class="pp"> </span><span class="co">/* Switched */</span><span class="pp">                                              </span><span class="op">\</span></span>
<span id="cb43-65"><a href="#cb43-65" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>left<span class="op">,</span><span class="pp">  </span><span class="co">/* Switched */</span><span class="pp">                                              </span><span class="op">\</span></span>
<span id="cb43-66"><a href="#cb43-66" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>tree<span class="op">,</span><span class="pp">                                                              </span><span class="op">\</span></span>
<span id="cb43-67"><a href="#cb43-67" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>node<span class="op">)</span></span>
<span id="cb43-68"><a href="#cb43-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-69"><a href="#cb43-69" aria-hidden="true" tabindex="-1"></a><span class="pp">#define _rb_rotate_right_tr_m</span><span class="op">(</span>cx<span class="op">,</span><span class="pp"> </span>tree<span class="op">,</span><span class="pp"> </span>node<span class="op">)</span><span class="pp">                                  </span><span class="op">\</span></span>
<span id="cb43-70"><a href="#cb43-70" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span>_rb_rotate_right_m<span class="op">(</span><span class="pp">                                                        </span><span class="op">\</span></span>
<span id="cb43-71"><a href="#cb43-71" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>cx<span class="pp">##</span>_type_t<span class="op">,</span><span class="pp">                                                       </span><span class="op">\</span></span>
<span id="cb43-72"><a href="#cb43-72" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>cx<span class="pp">##</span>_nil_ptr<span class="op">,</span><span class="pp">                                                      </span><span class="op">\</span></span>
<span id="cb43-73"><a href="#cb43-73" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>rb_color_m<span class="op">,</span><span class="pp">                                                        </span><span class="op">\</span></span>
<span id="cb43-74"><a href="#cb43-74" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>rb_parent_m<span class="op">,</span><span class="pp">                                                       </span><span class="op">\</span></span>
<span id="cb43-75"><a href="#cb43-75" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>rb_left_m<span class="op">,</span><span class="pp">                                                         </span><span class="op">\</span></span>
<span id="cb43-76"><a href="#cb43-76" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>rb_right_m<span class="op">,</span><span class="pp">                                                        </span><span class="op">\</span></span>
<span id="cb43-77"><a href="#cb43-77" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>tree<span class="op">,</span><span class="pp">                                                              </span><span class="op">\</span></span>
<span id="cb43-78"><a href="#cb43-78" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>node<span class="op">)</span></span></code></pre></div>
<h2 id="rb_insert_fix_m">_rb_insert_fix_m</h2>
<p>Internal: not bound</p>
<p>After inserting the new node is labeled red, and possibly destroys the red-black property. The main loop moves up the tree, restoring the red-black property.</p>
<dl class="incremental">
<dt>tree</dt>
<dd><p>The root node of the tree. A pointer to nil represents an empty tree.</p>
</dd>
<dt>node</dt>
<dd><p>The start-node to fix.</p>
</dd>
</dl>
<div class="sourceCode" id="cb44"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#define __rb_insert_fix_m</span><span class="op">(</span><span class="pp">                                                     </span><span class="op">\</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>type<span class="op">,</span><span class="pp"> </span>nil<span class="op">,</span><span class="pp"> </span>color<span class="op">,</span><span class="pp"> </span>parent<span class="op">,</span><span class="pp"> </span>left<span class="op">,</span><span class="pp"> </span>right<span class="op">,</span><span class="pp"> </span>tree<span class="op">,</span><span class="pp"> </span>node<span class="op">,</span><span class="pp"> </span>x<span class="op">,</span><span class="pp"> </span>y<span class="op">)</span><span class="pp">               </span><span class="op">\</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="op">{</span><span class="pp">                                                                          </span><span class="op">\</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>x<span class="pp"> </span><span class="op">=</span><span class="pp"> </span>node<span class="op">;</span><span class="pp">                                                              </span><span class="op">\</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="co">/* Move up the tree and fix property 3. */</span><span class="pp">                             </span><span class="op">\</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="cf">while</span><span class="pp"> </span><span class="op">((</span>x<span class="pp"> </span><span class="op">!=</span><span class="pp"> </span>tree<span class="op">)</span><span class="pp"> </span><span class="op">&amp;&amp;</span><span class="pp"> </span>rb_is_red_m<span class="op">(</span>color<span class="op">(</span>parent<span class="op">(</span>x<span class="op">))))</span><span class="pp"> </span><span class="op">{</span><span class="pp">                 </span><span class="op">\</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="cf">if</span><span class="pp"> </span><span class="op">(</span>parent<span class="op">(</span>x<span class="op">)</span><span class="pp"> </span><span class="op">==</span><span class="pp"> </span>left<span class="op">(</span>parent<span class="op">(</span>parent<span class="op">(</span>x<span class="op">))))</span><span class="pp"> </span><span class="op">{</span><span class="pp">                        </span><span class="op">\</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>_rb_insert_fix_node_m<span class="op">(</span><span class="pp">                                         </span><span class="op">\</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a><span class="pp">                        </span>type<span class="op">,</span><span class="pp">                                                  </span><span class="op">\</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a><span class="pp">                        </span>nil<span class="op">,</span><span class="pp">                                                   </span><span class="op">\</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a><span class="pp">                        </span>color<span class="op">,</span><span class="pp">                                                 </span><span class="op">\</span></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a><span class="pp">                        </span>parent<span class="op">,</span><span class="pp">                                                </span><span class="op">\</span></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a><span class="pp">                        </span>left<span class="op">,</span><span class="pp">                                                  </span><span class="op">\</span></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a><span class="pp">                        </span>right<span class="op">,</span><span class="pp">                                                 </span><span class="op">\</span></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a><span class="pp">                        </span>_rb_rotate_left_m<span class="op">,</span><span class="pp">                                     </span><span class="op">\</span></span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a><span class="pp">                        </span>_rb_rotate_right_m<span class="op">,</span><span class="pp">                                    </span><span class="op">\</span></span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a><span class="pp">                        </span>tree<span class="op">,</span><span class="pp">                                                  </span><span class="op">\</span></span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a><span class="pp">                        </span>x<span class="op">,</span><span class="pp">                                                     </span><span class="op">\</span></span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a><span class="pp">                        </span>y<span class="op">);</span><span class="pp">                                                    </span><span class="op">\</span></span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="op">}</span><span class="pp"> </span><span class="cf">else</span><span class="pp"> </span><span class="op">{</span><span class="pp">                                                           </span><span class="op">\</span></span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>_rb_insert_fix_node_m<span class="op">(</span><span class="pp">                                         </span><span class="op">\</span></span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a><span class="pp">                        </span>type<span class="op">,</span><span class="pp">                                                  </span><span class="op">\</span></span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a><span class="pp">                        </span>nil<span class="op">,</span><span class="pp">                                                   </span><span class="op">\</span></span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a><span class="pp">                        </span>color<span class="op">,</span><span class="pp">                                                 </span><span class="op">\</span></span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a><span class="pp">                        </span>parent<span class="op">,</span><span class="pp">                                                </span><span class="op">\</span></span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a><span class="pp">                        </span>right<span class="op">,</span><span class="pp"> </span><span class="co">/* Switched */</span><span class="pp">                                  </span><span class="op">\</span></span>
<span id="cb44-27"><a href="#cb44-27" aria-hidden="true" tabindex="-1"></a><span class="pp">                        </span>left<span class="op">,</span><span class="pp">  </span><span class="co">/* Switched */</span><span class="pp">                                  </span><span class="op">\</span></span>
<span id="cb44-28"><a href="#cb44-28" aria-hidden="true" tabindex="-1"></a><span class="pp">                        </span>_rb_rotate_left_m<span class="op">,</span><span class="pp">                                     </span><span class="op">\</span></span>
<span id="cb44-29"><a href="#cb44-29" aria-hidden="true" tabindex="-1"></a><span class="pp">                        </span>_rb_rotate_right_m<span class="op">,</span><span class="pp">                                    </span><span class="op">\</span></span>
<span id="cb44-30"><a href="#cb44-30" aria-hidden="true" tabindex="-1"></a><span class="pp">                        </span>tree<span class="op">,</span><span class="pp">                                                  </span><span class="op">\</span></span>
<span id="cb44-31"><a href="#cb44-31" aria-hidden="true" tabindex="-1"></a><span class="pp">                        </span>x<span class="op">,</span><span class="pp">                                                     </span><span class="op">\</span></span>
<span id="cb44-32"><a href="#cb44-32" aria-hidden="true" tabindex="-1"></a><span class="pp">                        </span>y<span class="op">);</span><span class="pp">                                                    </span><span class="op">\</span></span>
<span id="cb44-33"><a href="#cb44-33" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="op">}</span><span class="pp">                                                                  </span><span class="op">\</span></span>
<span id="cb44-34"><a href="#cb44-34" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="op">}</span><span class="pp">                                                                      </span><span class="op">\</span></span>
<span id="cb44-35"><a href="#cb44-35" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>rb_make_black_m<span class="op">(</span>color<span class="op">(</span>tree<span class="op">));</span><span class="pp">                                          </span><span class="op">\</span></span>
<span id="cb44-36"><a href="#cb44-36" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="op">}</span></span>
<span id="cb44-37"><a href="#cb44-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-38"><a href="#cb44-38" aria-hidden="true" tabindex="-1"></a><span class="pp">#define _rb_insert_fix_m</span><span class="op">(</span>type<span class="op">,</span><span class="pp"> </span>nil<span class="op">,</span><span class="pp"> </span>color<span class="op">,</span><span class="pp"> </span>parent<span class="op">,</span><span class="pp"> </span>left<span class="op">,</span><span class="pp"> </span>right<span class="op">,</span><span class="pp"> </span>tree<span class="op">,</span><span class="pp"> </span>node<span class="op">)</span><span class="pp">    </span><span class="op">\</span></span>
<span id="cb44-39"><a href="#cb44-39" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="op">{</span><span class="pp">                                                                          </span><span class="op">\</span></span>
<span id="cb44-40"><a href="#cb44-40" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>type<span class="op">*</span><span class="pp"> </span>__rb_insf_x_<span class="op">;</span><span class="pp">                                                    </span><span class="op">\</span></span>
<span id="cb44-41"><a href="#cb44-41" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>type<span class="op">*</span><span class="pp"> </span>__rb_insf_y_<span class="op">;</span><span class="pp">                                                    </span><span class="op">\</span></span>
<span id="cb44-42"><a href="#cb44-42" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>__rb_insert_fix_m<span class="op">(</span><span class="pp">                                                     </span><span class="op">\</span></span>
<span id="cb44-43"><a href="#cb44-43" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>type<span class="op">,</span><span class="pp">                                                          </span><span class="op">\</span></span>
<span id="cb44-44"><a href="#cb44-44" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>nil<span class="op">,</span><span class="pp">                                                           </span><span class="op">\</span></span>
<span id="cb44-45"><a href="#cb44-45" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>color<span class="op">,</span><span class="pp">                                                         </span><span class="op">\</span></span>
<span id="cb44-46"><a href="#cb44-46" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>parent<span class="op">,</span><span class="pp">                                                        </span><span class="op">\</span></span>
<span id="cb44-47"><a href="#cb44-47" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>left<span class="op">,</span><span class="pp">                                                          </span><span class="op">\</span></span>
<span id="cb44-48"><a href="#cb44-48" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>right<span class="op">,</span><span class="pp">                                                         </span><span class="op">\</span></span>
<span id="cb44-49"><a href="#cb44-49" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>tree<span class="op">,</span><span class="pp">                                                          </span><span class="op">\</span></span>
<span id="cb44-50"><a href="#cb44-50" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>node<span class="op">,</span><span class="pp">                                                          </span><span class="op">\</span></span>
<span id="cb44-51"><a href="#cb44-51" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>__rb_insf_x_<span class="op">,</span><span class="pp">                                                  </span><span class="op">\</span></span>
<span id="cb44-52"><a href="#cb44-52" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>__rb_insf_y_<span class="op">);</span><span class="pp">                                                 </span><span class="op">\</span></span>
<span id="cb44-53"><a href="#cb44-53" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="op">}</span></span>
<span id="cb44-54"><a href="#cb44-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-55"><a href="#cb44-55" aria-hidden="true" tabindex="-1"></a><span class="pp">#define _rb_insert_fix_node_m</span><span class="op">(</span><span class="pp">                                                 </span><span class="op">\</span></span>
<span id="cb44-56"><a href="#cb44-56" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>type<span class="op">,</span><span class="pp">                                                                  </span><span class="op">\</span></span>
<span id="cb44-57"><a href="#cb44-57" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>nil<span class="op">,</span><span class="pp">                                                                   </span><span class="op">\</span></span>
<span id="cb44-58"><a href="#cb44-58" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>color<span class="op">,</span><span class="pp">                                                                 </span><span class="op">\</span></span>
<span id="cb44-59"><a href="#cb44-59" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>parent<span class="op">,</span><span class="pp">                                                                </span><span class="op">\</span></span>
<span id="cb44-60"><a href="#cb44-60" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>left<span class="op">,</span><span class="pp">                                                                  </span><span class="op">\</span></span>
<span id="cb44-61"><a href="#cb44-61" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>right<span class="op">,</span><span class="pp">                                                                 </span><span class="op">\</span></span>
<span id="cb44-62"><a href="#cb44-62" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>rot_left<span class="op">,</span><span class="pp">                                                              </span><span class="op">\</span></span>
<span id="cb44-63"><a href="#cb44-63" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>rot_right<span class="op">,</span><span class="pp">                                                             </span><span class="op">\</span></span>
<span id="cb44-64"><a href="#cb44-64" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>tree<span class="op">,</span><span class="pp">                                                                  </span><span class="op">\</span></span>
<span id="cb44-65"><a href="#cb44-65" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>x<span class="op">,</span><span class="pp">                                                                     </span><span class="op">\</span></span>
<span id="cb44-66"><a href="#cb44-66" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>y<span class="op">)</span><span class="pp">                                                                     </span><span class="op">\</span></span>
<span id="cb44-67"><a href="#cb44-67" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="op">{</span><span class="pp">                                                                          </span><span class="op">\</span></span>
<span id="cb44-68"><a href="#cb44-68" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>y<span class="pp"> </span><span class="op">=</span><span class="pp"> </span>right<span class="op">(</span>parent<span class="op">(</span>parent<span class="op">(</span>x<span class="op">)));</span><span class="pp">                                          </span><span class="op">\</span></span>
<span id="cb44-69"><a href="#cb44-69" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="co">/* Case 1: z&#39;s uncle y is red. */</span><span class="pp">                                      </span><span class="op">\</span></span>
<span id="cb44-70"><a href="#cb44-70" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="cf">if</span><span class="pp"> </span><span class="op">(</span>rb_is_red_m<span class="op">(</span>color<span class="op">(</span>y<span class="op">)))</span><span class="pp"> </span><span class="op">{</span><span class="pp">                                           </span><span class="op">\</span></span>
<span id="cb44-71"><a href="#cb44-71" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>rb_make_black_m<span class="op">(</span>color<span class="op">(</span>parent<span class="op">(</span>x<span class="op">)));</span><span class="pp">                                 </span><span class="op">\</span></span>
<span id="cb44-72"><a href="#cb44-72" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>rb_make_black_m<span class="op">(</span>color<span class="op">(</span>y<span class="op">));</span><span class="pp">                                         </span><span class="op">\</span></span>
<span id="cb44-73"><a href="#cb44-73" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>rb_make_red_m<span class="op">(</span>color<span class="op">(</span>parent<span class="op">(</span>parent<span class="op">(</span>x<span class="op">))));</span><span class="pp">                           </span><span class="op">\</span></span>
<span id="cb44-74"><a href="#cb44-74" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="co">/* Locally property 3 is fixed, but changing the color of the      \</span></span>
<span id="cb44-75"><a href="#cb44-75" aria-hidden="true" tabindex="-1"></a><span class="co">             * grandparent might have created a new violation. We continue     \</span></span>
<span id="cb44-76"><a href="#cb44-76" aria-hidden="true" tabindex="-1"></a><span class="co">             * with the grandparent. */</span><span class="pp">                                                               </span><span class="op">\</span></span>
<span id="cb44-77"><a href="#cb44-77" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>x<span class="pp"> </span><span class="op">=</span><span class="pp"> </span>parent<span class="op">(</span>parent<span class="op">(</span>x<span class="op">));</span><span class="pp">                                             </span><span class="op">\</span></span>
<span id="cb44-78"><a href="#cb44-78" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="op">}</span><span class="pp"> </span><span class="cf">else</span><span class="pp"> </span><span class="op">{</span><span class="pp">                                                               </span><span class="op">\</span></span>
<span id="cb44-79"><a href="#cb44-79" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="co">/* Case 2: z&#39;s uncle y is black and z is a right child. */</span><span class="pp">         </span><span class="op">\</span></span>
<span id="cb44-80"><a href="#cb44-80" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="cf">if</span><span class="pp"> </span><span class="op">(</span>x<span class="pp"> </span><span class="op">==</span><span class="pp"> </span>right<span class="op">(</span>parent<span class="op">(</span>x<span class="op">)))</span><span class="pp"> </span><span class="op">{</span><span class="pp">                                       </span><span class="op">\</span></span>
<span id="cb44-81"><a href="#cb44-81" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>x<span class="pp"> </span><span class="op">=</span><span class="pp"> </span>parent<span class="op">(</span>x<span class="op">);</span><span class="pp">                                                 </span><span class="op">\</span></span>
<span id="cb44-82"><a href="#cb44-82" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>rot_left<span class="op">(</span>type<span class="op">,</span><span class="pp"> </span>nil<span class="op">,</span><span class="pp"> </span>color<span class="op">,</span><span class="pp"> </span>parent<span class="op">,</span><span class="pp"> </span>left<span class="op">,</span><span class="pp"> </span>right<span class="op">,</span><span class="pp"> </span>tree<span class="op">,</span><span class="pp"> </span>x<span class="op">);</span><span class="pp">      </span><span class="op">\</span></span>
<span id="cb44-83"><a href="#cb44-83" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="op">}</span><span class="pp">                                                                  </span><span class="op">\</span></span>
<span id="cb44-84"><a href="#cb44-84" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="co">/* Case 3: z&#39;s uncle y is black and z is a left child. */</span><span class="pp">          </span><span class="op">\</span></span>
<span id="cb44-85"><a href="#cb44-85" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>rb_make_black_m<span class="op">(</span>color<span class="op">(</span>parent<span class="op">(</span>x<span class="op">)));</span><span class="pp">                                 </span><span class="op">\</span></span>
<span id="cb44-86"><a href="#cb44-86" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>rb_make_red_m<span class="op">(</span>color<span class="op">(</span>parent<span class="op">(</span>parent<span class="op">(</span>x<span class="op">))));</span><span class="pp">                           </span><span class="op">\</span></span>
<span id="cb44-87"><a href="#cb44-87" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>rot_right<span class="op">(</span><span class="pp">                                                         </span><span class="op">\</span></span>
<span id="cb44-88"><a href="#cb44-88" aria-hidden="true" tabindex="-1"></a><span class="pp">                    </span>type<span class="op">,</span><span class="pp">                                                      </span><span class="op">\</span></span>
<span id="cb44-89"><a href="#cb44-89" aria-hidden="true" tabindex="-1"></a><span class="pp">                    </span>nil<span class="op">,</span><span class="pp">                                                       </span><span class="op">\</span></span>
<span id="cb44-90"><a href="#cb44-90" aria-hidden="true" tabindex="-1"></a><span class="pp">                    </span>color<span class="op">,</span><span class="pp">                                                     </span><span class="op">\</span></span>
<span id="cb44-91"><a href="#cb44-91" aria-hidden="true" tabindex="-1"></a><span class="pp">                    </span>parent<span class="op">,</span><span class="pp">                                                    </span><span class="op">\</span></span>
<span id="cb44-92"><a href="#cb44-92" aria-hidden="true" tabindex="-1"></a><span class="pp">                    </span>left<span class="op">,</span><span class="pp">                                                      </span><span class="op">\</span></span>
<span id="cb44-93"><a href="#cb44-93" aria-hidden="true" tabindex="-1"></a><span class="pp">                    </span>right<span class="op">,</span><span class="pp">                                                     </span><span class="op">\</span></span>
<span id="cb44-94"><a href="#cb44-94" aria-hidden="true" tabindex="-1"></a><span class="pp">                    </span>tree<span class="op">,</span><span class="pp">                                                      </span><span class="op">\</span></span>
<span id="cb44-95"><a href="#cb44-95" aria-hidden="true" tabindex="-1"></a><span class="pp">                    </span>parent<span class="op">(</span>parent<span class="op">(</span>x<span class="op">)));</span><span class="pp">                                        </span><span class="op">\</span></span>
<span id="cb44-96"><a href="#cb44-96" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="op">}</span><span class="pp">                                                                      </span><span class="op">\</span></span>
<span id="cb44-97"><a href="#cb44-97" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="op">}</span></span></code></pre></div>
<h2 id="rb_delete_fix_m">_rb_delete_fix_m</h2>
<p>Internal: not bound</p>
<p>After deleting a black node, the blackness is pushed down to the child. If it is black, it is now double (extra) black. Property 1 has to be restored.</p>
<dl class="incremental">
<dt>tree</dt>
<dd><p>The root node of the tree. A pointer to nil represents an empty tree.</p>
</dd>
<dt>node</dt>
<dd><p>The start-node to fix.</p>
</dd>
</dl>
<div class="sourceCode" id="cb45"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#define __rb_delete_fix_m</span><span class="op">(</span><span class="pp">                                                     </span><span class="op">\</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>type<span class="op">,</span><span class="pp"> </span>nil<span class="op">,</span><span class="pp"> </span>color<span class="op">,</span><span class="pp"> </span>parent<span class="op">,</span><span class="pp"> </span>left<span class="op">,</span><span class="pp"> </span>right<span class="op">,</span><span class="pp"> </span>tree<span class="op">,</span><span class="pp"> </span>node<span class="op">,</span><span class="pp"> </span>x<span class="op">,</span><span class="pp"> </span>y<span class="op">)</span><span class="pp">               </span><span class="op">\</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="op">{</span><span class="pp">                                                                          </span><span class="op">\</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>x<span class="pp"> </span><span class="op">=</span><span class="pp"> </span>node<span class="op">;</span><span class="pp">                                                              </span><span class="op">\</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="co">/* Move up fix extra blackness till x is red. */</span><span class="pp">                       </span><span class="op">\</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="cf">while</span><span class="pp"> </span><span class="op">((</span>x<span class="pp"> </span><span class="op">!=</span><span class="pp"> </span>tree<span class="op">)</span><span class="pp"> </span><span class="op">&amp;&amp;</span><span class="pp"> </span>rb_is_black_m<span class="op">(</span>color<span class="op">(</span>x<span class="op">)))</span><span class="pp"> </span><span class="op">{</span><span class="pp">                       </span><span class="op">\</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="cf">if</span><span class="pp"> </span><span class="op">(</span>x<span class="pp"> </span><span class="op">==</span><span class="pp"> </span>left<span class="op">(</span>parent<span class="op">(</span>x<span class="op">)))</span><span class="pp"> </span><span class="op">{</span><span class="pp">                                        </span><span class="op">\</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>_rb_delete_fix_node_m<span class="op">(</span><span class="pp">                                         </span><span class="op">\</span></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a><span class="pp">                        </span>type<span class="op">,</span><span class="pp">                                                  </span><span class="op">\</span></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a><span class="pp">                        </span>nil<span class="op">,</span><span class="pp">                                                   </span><span class="op">\</span></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a><span class="pp">                        </span>color<span class="op">,</span><span class="pp">                                                 </span><span class="op">\</span></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a><span class="pp">                        </span>parent<span class="op">,</span><span class="pp">                                                </span><span class="op">\</span></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a><span class="pp">                        </span>left<span class="op">,</span><span class="pp">                                                  </span><span class="op">\</span></span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a><span class="pp">                        </span>right<span class="op">,</span><span class="pp">                                                 </span><span class="op">\</span></span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a><span class="pp">                        </span>_rb_rotate_left_m<span class="op">,</span><span class="pp">                                     </span><span class="op">\</span></span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a><span class="pp">                        </span>_rb_rotate_right_m<span class="op">,</span><span class="pp">                                    </span><span class="op">\</span></span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a><span class="pp">                        </span>tree<span class="op">,</span><span class="pp">                                                  </span><span class="op">\</span></span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a><span class="pp">                        </span>x<span class="op">,</span><span class="pp">                                                     </span><span class="op">\</span></span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a><span class="pp">                        </span>y<span class="op">);</span><span class="pp">                                                    </span><span class="op">\</span></span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="op">}</span><span class="pp"> </span><span class="cf">else</span><span class="pp"> </span><span class="op">{</span><span class="pp">                                                           </span><span class="op">\</span></span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>_rb_delete_fix_node_m<span class="op">(</span><span class="pp">                                         </span><span class="op">\</span></span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a><span class="pp">                        </span>type<span class="op">,</span><span class="pp">                                                  </span><span class="op">\</span></span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a><span class="pp">                        </span>nil<span class="op">,</span><span class="pp">                                                   </span><span class="op">\</span></span>
<span id="cb45-24"><a href="#cb45-24" aria-hidden="true" tabindex="-1"></a><span class="pp">                        </span>color<span class="op">,</span><span class="pp">                                                 </span><span class="op">\</span></span>
<span id="cb45-25"><a href="#cb45-25" aria-hidden="true" tabindex="-1"></a><span class="pp">                        </span>parent<span class="op">,</span><span class="pp">                                                </span><span class="op">\</span></span>
<span id="cb45-26"><a href="#cb45-26" aria-hidden="true" tabindex="-1"></a><span class="pp">                        </span>right<span class="op">,</span><span class="pp"> </span><span class="co">/* Switched */</span><span class="pp">                                  </span><span class="op">\</span></span>
<span id="cb45-27"><a href="#cb45-27" aria-hidden="true" tabindex="-1"></a><span class="pp">                        </span>left<span class="op">,</span><span class="pp">  </span><span class="co">/* Switched */</span><span class="pp">                                  </span><span class="op">\</span></span>
<span id="cb45-28"><a href="#cb45-28" aria-hidden="true" tabindex="-1"></a><span class="pp">                        </span>_rb_rotate_left_m<span class="op">,</span><span class="pp">                                     </span><span class="op">\</span></span>
<span id="cb45-29"><a href="#cb45-29" aria-hidden="true" tabindex="-1"></a><span class="pp">                        </span>_rb_rotate_right_m<span class="op">,</span><span class="pp">                                    </span><span class="op">\</span></span>
<span id="cb45-30"><a href="#cb45-30" aria-hidden="true" tabindex="-1"></a><span class="pp">                        </span>tree<span class="op">,</span><span class="pp">                                                  </span><span class="op">\</span></span>
<span id="cb45-31"><a href="#cb45-31" aria-hidden="true" tabindex="-1"></a><span class="pp">                        </span>x<span class="op">,</span><span class="pp">                                                     </span><span class="op">\</span></span>
<span id="cb45-32"><a href="#cb45-32" aria-hidden="true" tabindex="-1"></a><span class="pp">                        </span>y<span class="op">);</span><span class="pp">                                                    </span><span class="op">\</span></span>
<span id="cb45-33"><a href="#cb45-33" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="op">}</span><span class="pp">                                                                  </span><span class="op">\</span></span>
<span id="cb45-34"><a href="#cb45-34" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="op">}</span><span class="pp">                                                                      </span><span class="op">\</span></span>
<span id="cb45-35"><a href="#cb45-35" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="co">/* If x is red we can introduce a real black node. */</span><span class="pp">                  </span><span class="op">\</span></span>
<span id="cb45-36"><a href="#cb45-36" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>rb_make_black_m<span class="op">(</span>color<span class="op">(</span>x<span class="op">));</span><span class="pp">                                             </span><span class="op">\</span></span>
<span id="cb45-37"><a href="#cb45-37" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="op">}</span></span>
<span id="cb45-38"><a href="#cb45-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-39"><a href="#cb45-39" aria-hidden="true" tabindex="-1"></a><span class="pp">#define _rb_delete_fix_m</span><span class="op">(</span>type<span class="op">,</span><span class="pp"> </span>nil<span class="op">,</span><span class="pp"> </span>color<span class="op">,</span><span class="pp"> </span>parent<span class="op">,</span><span class="pp"> </span>left<span class="op">,</span><span class="pp"> </span>right<span class="op">,</span><span class="pp"> </span>tree<span class="op">,</span><span class="pp"> </span>node<span class="op">)</span><span class="pp">    </span><span class="op">\</span></span>
<span id="cb45-40"><a href="#cb45-40" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="op">{</span><span class="pp">                                                                          </span><span class="op">\</span></span>
<span id="cb45-41"><a href="#cb45-41" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>type<span class="op">*</span><span class="pp"> </span>__rb_delf_x_<span class="op">;</span><span class="pp">                                                    </span><span class="op">\</span></span>
<span id="cb45-42"><a href="#cb45-42" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>type<span class="op">*</span><span class="pp"> </span>__rb_delf_y_<span class="op">;</span><span class="pp">                                                    </span><span class="op">\</span></span>
<span id="cb45-43"><a href="#cb45-43" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>__rb_delete_fix_m<span class="op">(</span><span class="pp">                                                     </span><span class="op">\</span></span>
<span id="cb45-44"><a href="#cb45-44" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>type<span class="op">,</span><span class="pp">                                                          </span><span class="op">\</span></span>
<span id="cb45-45"><a href="#cb45-45" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>nil<span class="op">,</span><span class="pp">                                                           </span><span class="op">\</span></span>
<span id="cb45-46"><a href="#cb45-46" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>color<span class="op">,</span><span class="pp">                                                         </span><span class="op">\</span></span>
<span id="cb45-47"><a href="#cb45-47" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>parent<span class="op">,</span><span class="pp">                                                        </span><span class="op">\</span></span>
<span id="cb45-48"><a href="#cb45-48" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>left<span class="op">,</span><span class="pp">                                                          </span><span class="op">\</span></span>
<span id="cb45-49"><a href="#cb45-49" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>right<span class="op">,</span><span class="pp">                                                         </span><span class="op">\</span></span>
<span id="cb45-50"><a href="#cb45-50" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>tree<span class="op">,</span><span class="pp">                                                          </span><span class="op">\</span></span>
<span id="cb45-51"><a href="#cb45-51" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>node<span class="op">,</span><span class="pp">                                                          </span><span class="op">\</span></span>
<span id="cb45-52"><a href="#cb45-52" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>__rb_delf_x_<span class="op">,</span><span class="pp">                                                  </span><span class="op">\</span></span>
<span id="cb45-53"><a href="#cb45-53" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>__rb_delf_y_<span class="op">);</span><span class="pp">                                                 </span><span class="op">\</span></span>
<span id="cb45-54"><a href="#cb45-54" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="op">}</span></span>
<span id="cb45-55"><a href="#cb45-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-56"><a href="#cb45-56" aria-hidden="true" tabindex="-1"></a><span class="pp">#define _rb_delete_fix_node_m</span><span class="op">(</span><span class="pp">                                                 </span><span class="op">\</span></span>
<span id="cb45-57"><a href="#cb45-57" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>type<span class="op">,</span><span class="pp">                                                                  </span><span class="op">\</span></span>
<span id="cb45-58"><a href="#cb45-58" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>nil<span class="op">,</span><span class="pp">                                                                   </span><span class="op">\</span></span>
<span id="cb45-59"><a href="#cb45-59" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>color<span class="op">,</span><span class="pp">                                                                 </span><span class="op">\</span></span>
<span id="cb45-60"><a href="#cb45-60" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>parent<span class="op">,</span><span class="pp">                                                                </span><span class="op">\</span></span>
<span id="cb45-61"><a href="#cb45-61" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>left<span class="op">,</span><span class="pp">                                                                  </span><span class="op">\</span></span>
<span id="cb45-62"><a href="#cb45-62" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>right<span class="op">,</span><span class="pp">                                                                 </span><span class="op">\</span></span>
<span id="cb45-63"><a href="#cb45-63" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>rot_left<span class="op">,</span><span class="pp">                                                              </span><span class="op">\</span></span>
<span id="cb45-64"><a href="#cb45-64" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>rot_right<span class="op">,</span><span class="pp">                                                             </span><span class="op">\</span></span>
<span id="cb45-65"><a href="#cb45-65" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>tree<span class="op">,</span><span class="pp">                                                                  </span><span class="op">\</span></span>
<span id="cb45-66"><a href="#cb45-66" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>x<span class="op">,</span><span class="pp">                                                                     </span><span class="op">\</span></span>
<span id="cb45-67"><a href="#cb45-67" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>w<span class="op">)</span><span class="pp">                                                                     </span><span class="op">\</span></span>
<span id="cb45-68"><a href="#cb45-68" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="op">{</span><span class="pp">                                                                          </span><span class="op">\</span></span>
<span id="cb45-69"><a href="#cb45-69" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="co">/* X is double (extra) black. Goal: introduce a real black node. */</span><span class="pp">    </span><span class="op">\</span></span>
<span id="cb45-70"><a href="#cb45-70" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span>w<span class="pp"> </span><span class="op">=</span><span class="pp"> </span>right<span class="op">(</span>parent<span class="op">(</span>x<span class="op">));</span><span class="pp">                                                  </span><span class="op">\</span></span>
<span id="cb45-71"><a href="#cb45-71" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="co">/* Case 1: x&#39;s sibling w is red. */</span><span class="pp">                                    </span><span class="op">\</span></span>
<span id="cb45-72"><a href="#cb45-72" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="cf">if</span><span class="pp"> </span><span class="op">(</span>rb_is_red_m<span class="op">(</span>color<span class="op">(</span>w<span class="op">)))</span><span class="pp"> </span><span class="op">{</span><span class="pp">                                           </span><span class="op">\</span></span>
<span id="cb45-73"><a href="#cb45-73" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>rb_make_black_m<span class="op">(</span>color<span class="op">(</span>w<span class="op">));</span><span class="pp">                                         </span><span class="op">\</span></span>
<span id="cb45-74"><a href="#cb45-74" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>rb_make_red_m<span class="op">(</span>color<span class="op">(</span>parent<span class="op">(</span>x<span class="op">)));</span><span class="pp">                                   </span><span class="op">\</span></span>
<span id="cb45-75"><a href="#cb45-75" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>rot_left<span class="op">(</span>type<span class="op">,</span><span class="pp"> </span>nil<span class="op">,</span><span class="pp"> </span>color<span class="op">,</span><span class="pp"> </span>parent<span class="op">,</span><span class="pp"> </span>left<span class="op">,</span><span class="pp"> </span>right<span class="op">,</span><span class="pp"> </span>tree<span class="op">,</span><span class="pp"> </span>parent<span class="op">(</span>x<span class="op">));</span><span class="pp">  </span><span class="op">\</span></span>
<span id="cb45-76"><a href="#cb45-76" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="co">/* Transforms into case 2, 3 or 4 */</span><span class="pp">                               </span><span class="op">\</span></span>
<span id="cb45-77"><a href="#cb45-77" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>w<span class="pp"> </span><span class="op">=</span><span class="pp"> </span>right<span class="op">(</span>parent<span class="op">(</span>x<span class="op">));</span><span class="pp">                                              </span><span class="op">\</span></span>
<span id="cb45-78"><a href="#cb45-78" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="op">}</span><span class="pp">                                                                      </span><span class="op">\</span></span>
<span id="cb45-79"><a href="#cb45-79" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="cf">if</span><span class="pp"> </span><span class="op">(</span>rb_is_black_m<span class="op">(</span>color<span class="op">(</span>left<span class="op">(</span>w<span class="op">)))</span><span class="pp"> </span><span class="op">&amp;&amp;</span><span class="pp"> </span>rb_is_black_m<span class="op">(</span>color<span class="op">(</span>right<span class="op">(</span>w<span class="op">))))</span><span class="pp"> </span><span class="op">{</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb45-80"><a href="#cb45-80" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="co">/* Case 2: x&#39;s sibling w is black, and both of w&#39;s children are    \</span></span>
<span id="cb45-81"><a href="#cb45-81" aria-hidden="true" tabindex="-1"></a><span class="co">             * black. */</span><span class="pp">                                                       </span><span class="op">\</span></span>
<span id="cb45-82"><a href="#cb45-82" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>rb_make_red_m<span class="op">(</span>color<span class="op">(</span>w<span class="op">));</span><span class="pp">                                           </span><span class="op">\</span></span>
<span id="cb45-83"><a href="#cb45-83" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="co">/* Double blackness move up. Reenter loop. */</span><span class="pp">                      </span><span class="op">\</span></span>
<span id="cb45-84"><a href="#cb45-84" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>x<span class="pp"> </span><span class="op">=</span><span class="pp"> </span>parent<span class="op">(</span>x<span class="op">);</span><span class="pp">                                                     </span><span class="op">\</span></span>
<span id="cb45-85"><a href="#cb45-85" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="op">}</span><span class="pp"> </span><span class="cf">else</span><span class="pp"> </span><span class="op">{</span><span class="pp">                                                               </span><span class="op">\</span></span>
<span id="cb45-86"><a href="#cb45-86" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="co">/* Case 3: x&#39;s sibling w is black, w&#39;s left child is red, and w&#39;s  \</span></span>
<span id="cb45-87"><a href="#cb45-87" aria-hidden="true" tabindex="-1"></a><span class="co">             * right child is black. */</span><span class="pp">                                                            </span><span class="op">\</span></span>
<span id="cb45-88"><a href="#cb45-88" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="cf">if</span><span class="pp"> </span><span class="op">(</span>rb_is_black_m<span class="op">(</span>color<span class="op">(</span>right<span class="op">(</span>w<span class="op">))))</span><span class="pp"> </span><span class="op">{</span><span class="pp">                              </span><span class="op">\</span></span>
<span id="cb45-89"><a href="#cb45-89" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>rb_make_black_m<span class="op">(</span>color<span class="op">(</span>left<span class="op">(</span>w<span class="op">)));</span><span class="pp">                               </span><span class="op">\</span></span>
<span id="cb45-90"><a href="#cb45-90" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>rb_make_red_m<span class="op">(</span>color<span class="op">(</span>w<span class="op">));</span><span class="pp">                                       </span><span class="op">\</span></span>
<span id="cb45-91"><a href="#cb45-91" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>rot_right<span class="op">(</span>type<span class="op">,</span><span class="pp"> </span>nil<span class="op">,</span><span class="pp"> </span>color<span class="op">,</span><span class="pp"> </span>parent<span class="op">,</span><span class="pp"> </span>left<span class="op">,</span><span class="pp"> </span>right<span class="op">,</span><span class="pp"> </span>tree<span class="op">,</span><span class="pp"> </span>w<span class="op">);</span><span class="pp">     </span><span class="op">\</span></span>
<span id="cb45-92"><a href="#cb45-92" aria-hidden="true" tabindex="-1"></a><span class="pp">                </span>w<span class="pp"> </span><span class="op">=</span><span class="pp"> </span>right<span class="op">(</span>parent<span class="op">(</span>x<span class="op">));</span><span class="pp">                                          </span><span class="op">\</span></span>
<span id="cb45-93"><a href="#cb45-93" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="op">}</span><span class="pp">                                                                  </span><span class="op">\</span></span>
<span id="cb45-94"><a href="#cb45-94" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="co">/* Case 3: x&#39;s sibling w is black, w&#39;s left child is red, and w&#39;s  \</span></span>
<span id="cb45-95"><a href="#cb45-95" aria-hidden="true" tabindex="-1"></a><span class="co">             * right child is black. */</span><span class="pp">                                                            </span><span class="op">\</span></span>
<span id="cb45-96"><a href="#cb45-96" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>color<span class="op">(</span>w<span class="op">)</span><span class="pp"> </span><span class="op">=</span><span class="pp"> </span>color<span class="op">(</span>parent<span class="op">(</span>x<span class="op">));</span><span class="pp">                                       </span><span class="op">\</span></span>
<span id="cb45-97"><a href="#cb45-97" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>rb_make_black_m<span class="op">(</span>color<span class="op">(</span>parent<span class="op">(</span>x<span class="op">)));</span><span class="pp">                                 </span><span class="op">\</span></span>
<span id="cb45-98"><a href="#cb45-98" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>rb_make_black_m<span class="op">(</span>color<span class="op">(</span>right<span class="op">(</span>w<span class="op">)));</span><span class="pp">                                  </span><span class="op">\</span></span>
<span id="cb45-99"><a href="#cb45-99" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>rot_left<span class="op">(</span>type<span class="op">,</span><span class="pp"> </span>nil<span class="op">,</span><span class="pp"> </span>color<span class="op">,</span><span class="pp"> </span>parent<span class="op">,</span><span class="pp"> </span>left<span class="op">,</span><span class="pp"> </span>right<span class="op">,</span><span class="pp"> </span>tree<span class="op">,</span><span class="pp"> </span>parent<span class="op">(</span>x<span class="op">));</span><span class="pp">  </span><span class="op">\</span></span>
<span id="cb45-100"><a href="#cb45-100" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span><span class="co">/* Terminate the loop. */</span><span class="pp">                                          </span><span class="op">\</span></span>
<span id="cb45-101"><a href="#cb45-101" aria-hidden="true" tabindex="-1"></a><span class="pp">            </span>x<span class="pp"> </span><span class="op">=</span><span class="pp"> </span>tree<span class="op">;</span><span class="pp">                                                          </span><span class="op">\</span></span>
<span id="cb45-102"><a href="#cb45-102" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="op">}</span><span class="pp">                                                                      </span><span class="op">\</span></span>
<span id="cb45-103"><a href="#cb45-103" aria-hidden="true" tabindex="-1"></a><span class="pp">        </span><span class="co">/* When the loop ends x is red and will be colored black. */</span><span class="pp">           </span><span class="op">\</span></span>
<span id="cb45-104"><a href="#cb45-104" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="op">}</span></span>
<span id="cb45-105"><a href="#cb45-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-106"><a href="#cb45-106" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif </span><span class="co">// rb_tree_h</span></span></code></pre></div>
</body>
</html>
